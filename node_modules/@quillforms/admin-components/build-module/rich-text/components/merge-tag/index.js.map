{"version":3,"names":["useEffect","Icon","plus","close","Editor","Transforms","classnames","css","getPlainExcerpt","EditorMergeTag","attributes","editor","children","path","element","mergeTags","type","modifier","data","node","mergeTag","find","a","mergeTagIcon","icon","renderedIcon","createElement","src","apply","insertNodes","text","at","Fragment","contentEditable","className","color","dangerouslySetInnerHTML","__html","label","onClick","setTimeout"],"sources":["@quillforms/admin-components/src/rich-text/components/merge-tag/index.tsx"],"sourcesContent":["/**\n * QuillForms Dependencies\n */\nimport type { IconDescriptor, Icon as IconType } from '@quillforms/types';\n/**\n * WordPress Dependencies\n */\nimport { useEffect } from 'react';\n// @ts-expect-error\nimport { Icon, Dashicon } from '@wordpress/components';\nimport { plus, close } from '@wordpress/icons';\n\n/**\n * External Dependencies\n */\nimport { Editor, Path, Transforms } from 'slate';\nimport classnames from 'classnames';\nimport { css } from 'emotion';\nimport { ReactEditor, RenderElementProps } from 'slate-react';\n\n/**\n * Internal Dependencies\n */\nimport getPlainExcerpt from '../../get-plain-excerpt';\nimport type { MergeTags, MergeTag, CustomElement } from '../../types';\n\ninterface Props extends RenderElementProps {\n\tpath: Path;\n\tmergeTags: MergeTags;\n\teditor: ReactEditor;\n\tchildren: React.ReactNode;\n\telement: CustomElement;\n}\nconst EditorMergeTag: React.FC<Props> = ({\n\tattributes,\n\teditor,\n\tchildren,\n\tpath,\n\telement,\n\tmergeTags,\n}) => {\n\tconst { type, modifier } = element.data as MergeTag;\n\tconst [node] = Editor.node(editor, path);\n\n\tconst mergeTag = mergeTags.find(\n\t\t(a) => a.type === type && a.modifier === modifier\n\t);\n\tconst mergeTagIcon = mergeTag?.icon ? mergeTag.icon : plus;\n\tconst renderedIcon = (\n\t\t<Icon\n\t\t\ticon={\n\t\t\t\t((mergeTagIcon as IconDescriptor)?.src as IconType)\n\t\t\t\t\t? ((mergeTagIcon as IconDescriptor)?.src as IconType)\n\t\t\t\t\t// @ts-expect-error\n\t\t\t\t\t: (mergeTagIcon as Dashicon.Icon)\n\t\t\t}\n\t\t/>\n\t);\n\n\tuseEffect(() => {\n\t\tif (!mergeTag) {\n\t\t\teditor.apply({ type: 'remove_node', path, node });\n\t\t\tTransforms.insertNodes(\n\t\t\t\teditor,\n\t\t\t\t{\n\t\t\t\t\ttext: `{{${type}:${modifier}}}`,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tat: path,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}, []);\n\treturn (\n\t\t<>\n\t\t\t{mergeTag && (\n\t\t\t\t<span\n\t\t\t\t\t{...attributes}\n\t\t\t\t\tcontentEditable={false}\n\t\t\t\t\tclassName={classnames(\n\t\t\t\t\t\t'rich-text-merge-tag__node-wrapper',\n\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\tcolor: ${mergeTag?.color\n\t\t\t\t\t\t\t\t? mergeTag.color\n\t\t\t\t\t\t\t\t: '#bb426f'};\n\t\t\t\t\t\t\tbordercolor: ${mergeTag?.color\n\t\t\t\t\t\t\t\t? mergeTag.color\n\t\t\t\t\t\t\t\t: '#bb426f'};\n\t\t\t\t\t\t\tfill: ${mergeTag?.color\n\t\t\t\t\t\t\t\t? mergeTag.color\n\t\t\t\t\t\t\t\t: '#bb426f'};\n\t\t\t\t\t\t`\n\t\t\t\t\t)}\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclassName={classnames(\n\t\t\t\t\t\t\t'rich-text-merge-tag__background',\n\t\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t\tbackground: ${mergeTag?.color\n\t\t\t\t\t\t\t\t\t? mergeTag.color\n\t\t\t\t\t\t\t\t\t: '#bb426f'};\n\t\t\t\t\t\t\t`\n\t\t\t\t\t\t)}\n\t\t\t\t\t/>\n\t\t\t\t\t<span className=\"rich-text-merge-tag__icon-box\">\n\t\t\t\t\t\t{renderedIcon}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclassName=\"rich-text-merge-tag__title\"\n\t\t\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t\t\t__html: getPlainExcerpt(mergeTag.label),\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName=\"rich-text-merge-tag__delete\"\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\teditor.apply({\n\t\t\t\t\t\t\t\t\ttype: 'remove_node',\n\t\t\t\t\t\t\t\t\tpath,\n\t\t\t\t\t\t\t\t\tnode,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}, 0);\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Icon icon={close} />\n\t\t\t\t\t</button>\n\t\t\t\t\t{children}\n\t\t\t\t</span>\n\t\t\t)}\n\t\t</>\n\t);\n};\nexport default EditorMergeTag;\n"],"mappings":"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","ignoreList":[]}