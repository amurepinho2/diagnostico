{"version":3,"names":["Transforms","Editor","Range","isUrl","isLinkActive","editor","link","nodes","match","n","type","unwrapLink","unwrapNodes","wrapLink","url","selection","isCollapsed","children","text","insertNodes","wrapNodes","split","collapse","edge","withLinks","insertData","insertText","isInline","element","data","getData"],"sources":["@quillforms/admin-components/src/rich-text/plugins/with-links.ts"],"sourcesContent":["import { Transforms, Editor, Range } from 'slate';\nimport isUrl from 'is-url';\nimport { CustomEditor, CustomNode } from '../types';\n\nconst isLinkActive = ( editor ) => {\n\tconst [ link ] = Editor.nodes( editor, {\n\t\tmatch: ( n: CustomNode ) => n.type === 'link',\n\t} );\n\treturn !! link;\n};\n\nconst unwrapLink = ( editor: CustomEditor ) => {\n\tTransforms.unwrapNodes( editor, {\n\t\tmatch: ( n: CustomNode ) => n.type === 'link',\n\t} );\n};\n\nconst wrapLink = ( editor, url: string ) => {\n\tif ( isLinkActive( editor ) ) {\n\t\tunwrapLink( editor );\n\t}\n\n\tconst { selection } = editor;\n\tconst isCollapsed = selection && Range.isCollapsed( selection );\n\tconst link = {\n\t\ttype: 'link',\n\t\turl,\n\t\tchildren: isCollapsed ? [ { text: url } ] : [],\n\t};\n\n\tif ( isCollapsed ) {\n\t\tTransforms.insertNodes( editor, link );\n\t} else {\n\t\tTransforms.wrapNodes( editor, link, { split: true } );\n\t\tTransforms.collapse( editor, { edge: 'end' } );\n\t}\n};\n\nexport const withLinks = ( editor ) => {\n\tconst { insertData, insertText, isInline } = editor;\n\n\teditor.isInline = ( element ) => {\n\t\treturn element.type === 'link' ? true : isInline( element );\n\t};\n\n\teditor.insertText = ( text ) => {\n\t\tif ( text && isUrl( text ) ) {\n\t\t\twrapLink( editor, text );\n\t\t} else {\n\t\t\tinsertText( text );\n\t\t}\n\t};\n\n\teditor.insertData = ( data ) => {\n\t\tconst text = data.getData( 'text/plain' );\n\n\t\tif ( text && isUrl( text ) ) {\n\t\t\twrapLink( editor, text );\n\t\t} else {\n\t\t\tinsertData( data );\n\t\t}\n\t};\n\n\treturn editor;\n};\n"],"mappings":"AAAA,SAASA,UAAU,EAAEC,MAAM,EAAEC,KAAK,QAAQ,OAAO;AACjD,OAAOC,KAAK,MAAM,QAAQ;AAG1B,MAAMC,YAAY,GAAKC,MAAM,IAAM;EAClC,MAAM,CAAEC,IAAI,CAAE,GAAGL,MAAM,CAACM,KAAK,CAAEF,MAAM,EAAE;IACtCG,KAAK,EAAIC,CAAa,IAAMA,CAAC,CAACC,IAAI,KAAK;EACxC,CAAE,CAAC;EACH,OAAO,CAAC,CAAEJ,IAAI;AACf,CAAC;AAED,MAAMK,UAAU,GAAKN,MAAoB,IAAM;EAC9CL,UAAU,CAACY,WAAW,CAAEP,MAAM,EAAE;IAC/BG,KAAK,EAAIC,CAAa,IAAMA,CAAC,CAACC,IAAI,KAAK;EACxC,CAAE,CAAC;AACJ,CAAC;AAED,MAAMG,QAAQ,GAAGA,CAAER,MAAM,EAAES,GAAW,KAAM;EAC3C,IAAKV,YAAY,CAAEC,MAAO,CAAC,EAAG;IAC7BM,UAAU,CAAEN,MAAO,CAAC;EACrB;EAEA,MAAM;IAAEU;EAAU,CAAC,GAAGV,MAAM;EAC5B,MAAMW,WAAW,GAAGD,SAAS,IAAIb,KAAK,CAACc,WAAW,CAAED,SAAU,CAAC;EAC/D,MAAMT,IAAI,GAAG;IACZI,IAAI,EAAE,MAAM;IACZI,GAAG;IACHG,QAAQ,EAAED,WAAW,GAAG,CAAE;MAAEE,IAAI,EAAEJ;IAAI,CAAC,CAAE,GAAG;EAC7C,CAAC;EAED,IAAKE,WAAW,EAAG;IAClBhB,UAAU,CAACmB,WAAW,CAAEd,MAAM,EAAEC,IAAK,CAAC;EACvC,CAAC,MAAM;IACNN,UAAU,CAACoB,SAAS,CAAEf,MAAM,EAAEC,IAAI,EAAE;MAAEe,KAAK,EAAE;IAAK,CAAE,CAAC;IACrDrB,UAAU,CAACsB,QAAQ,CAAEjB,MAAM,EAAE;MAAEkB,IAAI,EAAE;IAAM,CAAE,CAAC;EAC/C;AACD,CAAC;AAED,OAAO,MAAMC,SAAS,GAAKnB,MAAM,IAAM;EACtC,MAAM;IAAEoB,UAAU;IAAEC,UAAU;IAAEC;EAAS,CAAC,GAAGtB,MAAM;EAEnDA,MAAM,CAACsB,QAAQ,GAAKC,OAAO,IAAM;IAChC,OAAOA,OAAO,CAAClB,IAAI,KAAK,MAAM,GAAG,IAAI,GAAGiB,QAAQ,CAAEC,OAAQ,CAAC;EAC5D,CAAC;EAEDvB,MAAM,CAACqB,UAAU,GAAKR,IAAI,IAAM;IAC/B,IAAKA,IAAI,IAAIf,KAAK,CAAEe,IAAK,CAAC,EAAG;MAC5BL,QAAQ,CAAER,MAAM,EAAEa,IAAK,CAAC;IACzB,CAAC,MAAM;MACNQ,UAAU,CAAER,IAAK,CAAC;IACnB;EACD,CAAC;EAEDb,MAAM,CAACoB,UAAU,GAAKI,IAAI,IAAM;IAC/B,MAAMX,IAAI,GAAGW,IAAI,CAACC,OAAO,CAAE,YAAa,CAAC;IAEzC,IAAKZ,IAAI,IAAIf,KAAK,CAAEe,IAAK,CAAC,EAAG;MAC5BL,QAAQ,CAAER,MAAM,EAAEa,IAAK,CAAC;IACzB,CAAC,MAAM;MACNO,UAAU,CAAEI,IAAK,CAAC;IACnB;EACD,CAAC;EAED,OAAOxB,MAAM;AACd,CAAC","ignoreList":[]}