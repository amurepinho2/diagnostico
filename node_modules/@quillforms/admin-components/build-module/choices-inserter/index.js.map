{"version":3,"names":["useMemo","FixedSizeList","List","cloneDeep","ChoiceContextProvider","ChoiceWrapper","ChoiceRow","__experimentalDragDropContext","__experimentalDroppable","generateChoiceId","ChoicesInserter","choices","setChoices","withAttachment","labelChangeHandler","val","index","$choices","label","addChoice","at","splice","value","deleteChoice","newChoices","filter","choice","deleteImageHandler","imageUrl","undefined","handleMediaUpload","media","url","context","createElement","onDragEnd","result","source","destination","sourceIndex","destinationIndex","output","Array","from","removed","Object","values","droppableId","mode","renderClone","provided","_snapshot","rubric","draggableProps","dragHandleProps","ref","innerRef","style","zIndex","snapshot","itemCount","isUsingPlaceholder","length","droppableProps","className","outerRef","height","width","itemSize","itemData"],"sources":["@quillforms/admin-components/src/choices-inserter/index.tsx"],"sourcesContent":["/**\n * WordPress Dependencies\n */\nimport { useMemo } from 'react';\n\n/**\n * External Dependencies\n */\nimport { FixedSizeList as List } from 'react-window';\nimport { cloneDeep } from 'lodash';\n\n/**\n * Internal Dependencies\n */\nimport { ChoiceContextProvider } from './choices-context';\nimport ChoiceWrapper from './choice-wrapper';\nimport ChoiceRow from './choice-row';\nimport __experimentalDragDropContext from '../drag-drop-context';\nimport __experimentalDroppable from '../droppable';\nimport generateChoiceId from './generate-choice-id';\nimport type { Choices } from '../choices-bulk-btn/types';\n\ninterface Props {\n\tchoices: Choices;\n\tsetChoices: ( choices: Choices ) => void;\n\twithAttachment: boolean;\n}\nconst ChoicesInserter: React.FC< Props > = ( {\n\tchoices,\n\tsetChoices,\n\twithAttachment,\n} ) => {\n\tconst labelChangeHandler = ( val: string, index: number ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices[ index ] = { ...$choices[ index ], label: val };\n\t\tsetChoices( $choices );\n\t};\n\n\tconst addChoice = ( at: number ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices.splice( at, 0, {\n\t\t\tvalue: generateChoiceId(),\n\t\t\tlabel: '',\n\t\t} );\n\t\tsetChoices( $choices );\n\t};\n\n\tconst deleteChoice = ( value: string ) => {\n\t\tconst newChoices = cloneDeep( choices ).filter(\n\t\t\t( choice ) => choice.value !== value\n\t\t);\n\t\tsetChoices( newChoices );\n\t};\n\n\tconst deleteImageHandler = ( index ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices[ index ].imageUrl = undefined;\n\t\tsetChoices( $choices );\n\t};\n\tconst handleMediaUpload = ( media, index ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices[ index ].imageUrl = media.url;\n\t\tsetChoices( $choices );\n\t};\n\n\tconst context = {\n\t\taddChoice,\n\t\tlabelChangeHandler,\n\t\tdeleteChoice,\n\t\tdeleteImageHandler,\n\t\thandleMediaUpload,\n\t\twithAttachment,\n\t};\n\n\treturn (\n\t\t<__experimentalDragDropContext\n\t\t\tonDragEnd={ ( result ) => {\n\t\t\t\tconst { source, destination } = result;\n\t\t\t\tif (\n\t\t\t\t\t! result.destination ||\n\t\t\t\t\tresult.source.index === result.destination.index\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst sourceIndex = source.index;\n\t\t\t\tconst destinationIndex = destination?.index;\n\t\t\t\tconst $choices = [ ...choices ];\n\t\t\t\tconst output = Array.from( $choices );\n\t\t\t\tconst [ removed ] = output.splice( sourceIndex, 1 );\n\t\t\t\tif ( destinationIndex !== undefined ) {\n\t\t\t\t\toutput.splice( destinationIndex, 0, removed );\n\t\t\t\t\tsetChoices( output );\n\t\t\t\t}\n\t\t\t} }\n\t\t>\n\t\t\t<ChoiceContextProvider\n\t\t\t\t// It is important to return the same object if props haven't\n\t\t\t\t// changed to avoid  unnecessary rerenders.\n\t\t\t\t// See https://reactjs.org/docs/context.html#caveats.\n\t\t\t\tvalue={ useMemo( () => context, Object.values( context ) ) }\n\t\t\t>\n\t\t\t\t<__experimentalDroppable\n\t\t\t\t\tdroppableId=\"CHOICES_DROP_AREA\"\n\t\t\t\t\tmode=\"virtual\"\n\t\t\t\t\trenderClone={ ( provided, _snapshot, rubric ) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t{ ...provided.draggableProps }\n\t\t\t\t\t\t\t\t{ ...provided.dragHandleProps }\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t...provided.draggableProps.style,\n\t\t\t\t\t\t\t\t\tzIndex: 111111111,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ChoiceRow\n\t\t\t\t\t\t\t\t\tchoices={ choices }\n\t\t\t\t\t\t\t\t\tindex={ rubric.source.index }\n\t\t\t\t\t\t\t\t\tprovided={ provided }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t{ ( provided, snapshot ) => {\n\t\t\t\t\t\tconst itemCount = snapshot.isUsingPlaceholder\n\t\t\t\t\t\t\t? choices.length + 1\n\t\t\t\t\t\t\t: choices.length;\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\n\t\t\t\t\t\t\t\t{ ...provided.droppableProps }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<List\n\t\t\t\t\t\t\t\t\tclassName=\"admin-components-choices-inserter__choices-wrapper\"\n\t\t\t\t\t\t\t\t\touterRef={ provided.innerRef }\n\t\t\t\t\t\t\t\t\theight={ 250 }\n\t\t\t\t\t\t\t\t\twidth={ '100%' }\n\t\t\t\t\t\t\t\t\titemCount={ itemCount }\n\t\t\t\t\t\t\t\t\titemSize={ 54 }\n\t\t\t\t\t\t\t\t\titemData={ choices }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ ChoiceWrapper }\n\t\t\t\t\t\t\t\t</List>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t} }\n\t\t\t\t</__experimentalDroppable>\n\t\t\t</ChoiceContextProvider>\n\t\t</__experimentalDragDropContext>\n\t);\n};\n\nexport default ChoicesInserter;\n"],"mappings":"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","ignoreList":[]}