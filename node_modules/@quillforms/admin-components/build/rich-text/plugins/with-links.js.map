{"version":3,"names":["_slate","require","_isUrl","_interopRequireDefault","isLinkActive","editor","link","Editor","nodes","match","n","type","unwrapLink","Transforms","unwrapNodes","wrapLink","url","selection","isCollapsed","Range","children","text","insertNodes","wrapNodes","split","collapse","edge","withLinks","insertData","insertText","isInline","element","isUrl","data","getData","exports"],"sources":["@quillforms/admin-components/src/rich-text/plugins/with-links.ts"],"sourcesContent":["import { Transforms, Editor, Range } from 'slate';\nimport isUrl from 'is-url';\nimport { CustomEditor, CustomNode } from '../types';\n\nconst isLinkActive = ( editor ) => {\n\tconst [ link ] = Editor.nodes( editor, {\n\t\tmatch: ( n: CustomNode ) => n.type === 'link',\n\t} );\n\treturn !! link;\n};\n\nconst unwrapLink = ( editor: CustomEditor ) => {\n\tTransforms.unwrapNodes( editor, {\n\t\tmatch: ( n: CustomNode ) => n.type === 'link',\n\t} );\n};\n\nconst wrapLink = ( editor, url: string ) => {\n\tif ( isLinkActive( editor ) ) {\n\t\tunwrapLink( editor );\n\t}\n\n\tconst { selection } = editor;\n\tconst isCollapsed = selection && Range.isCollapsed( selection );\n\tconst link = {\n\t\ttype: 'link',\n\t\turl,\n\t\tchildren: isCollapsed ? [ { text: url } ] : [],\n\t};\n\n\tif ( isCollapsed ) {\n\t\tTransforms.insertNodes( editor, link );\n\t} else {\n\t\tTransforms.wrapNodes( editor, link, { split: true } );\n\t\tTransforms.collapse( editor, { edge: 'end' } );\n\t}\n};\n\nexport const withLinks = ( editor ) => {\n\tconst { insertData, insertText, isInline } = editor;\n\n\teditor.isInline = ( element ) => {\n\t\treturn element.type === 'link' ? true : isInline( element );\n\t};\n\n\teditor.insertText = ( text ) => {\n\t\tif ( text && isUrl( text ) ) {\n\t\t\twrapLink( editor, text );\n\t\t} else {\n\t\t\tinsertText( text );\n\t\t}\n\t};\n\n\teditor.insertData = ( data ) => {\n\t\tconst text = data.getData( 'text/plain' );\n\n\t\tif ( text && isUrl( text ) ) {\n\t\t\twrapLink( editor, text );\n\t\t} else {\n\t\t\tinsertData( data );\n\t\t}\n\t};\n\n\treturn editor;\n};\n"],"mappings":";;;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AACA,IAAAC,MAAA,GAAAC,sBAAA,CAAAF,OAAA;AAGA,MAAMG,YAAY,GAAKC,MAAM,IAAM;EAClC,MAAM,CAAEC,IAAI,CAAE,GAAGC,aAAM,CAACC,KAAK,CAAEH,MAAM,EAAE;IACtCI,KAAK,EAAIC,CAAa,IAAMA,CAAC,CAACC,IAAI,KAAK;EACxC,CAAE,CAAC;EACH,OAAO,CAAC,CAAEL,IAAI;AACf,CAAC;AAED,MAAMM,UAAU,GAAKP,MAAoB,IAAM;EAC9CQ,iBAAU,CAACC,WAAW,CAAET,MAAM,EAAE;IAC/BI,KAAK,EAAIC,CAAa,IAAMA,CAAC,CAACC,IAAI,KAAK;EACxC,CAAE,CAAC;AACJ,CAAC;AAED,MAAMI,QAAQ,GAAGA,CAAEV,MAAM,EAAEW,GAAW,KAAM;EAC3C,IAAKZ,YAAY,CAAEC,MAAO,CAAC,EAAG;IAC7BO,UAAU,CAAEP,MAAO,CAAC;EACrB;EAEA,MAAM;IAAEY;EAAU,CAAC,GAAGZ,MAAM;EAC5B,MAAMa,WAAW,GAAGD,SAAS,IAAIE,YAAK,CAACD,WAAW,CAAED,SAAU,CAAC;EAC/D,MAAMX,IAAI,GAAG;IACZK,IAAI,EAAE,MAAM;IACZK,GAAG;IACHI,QAAQ,EAAEF,WAAW,GAAG,CAAE;MAAEG,IAAI,EAAEL;IAAI,CAAC,CAAE,GAAG;EAC7C,CAAC;EAED,IAAKE,WAAW,EAAG;IAClBL,iBAAU,CAACS,WAAW,CAAEjB,MAAM,EAAEC,IAAK,CAAC;EACvC,CAAC,MAAM;IACNO,iBAAU,CAACU,SAAS,CAAElB,MAAM,EAAEC,IAAI,EAAE;MAAEkB,KAAK,EAAE;IAAK,CAAE,CAAC;IACrDX,iBAAU,CAACY,QAAQ,CAAEpB,MAAM,EAAE;MAAEqB,IAAI,EAAE;IAAM,CAAE,CAAC;EAC/C;AACD,CAAC;AAEM,MAAMC,SAAS,GAAKtB,MAAM,IAAM;EACtC,MAAM;IAAEuB,UAAU;IAAEC,UAAU;IAAEC;EAAS,CAAC,GAAGzB,MAAM;EAEnDA,MAAM,CAACyB,QAAQ,GAAKC,OAAO,IAAM;IAChC,OAAOA,OAAO,CAACpB,IAAI,KAAK,MAAM,GAAG,IAAI,GAAGmB,QAAQ,CAAEC,OAAQ,CAAC;EAC5D,CAAC;EAED1B,MAAM,CAACwB,UAAU,GAAKR,IAAI,IAAM;IAC/B,IAAKA,IAAI,IAAI,IAAAW,cAAK,EAAEX,IAAK,CAAC,EAAG;MAC5BN,QAAQ,CAAEV,MAAM,EAAEgB,IAAK,CAAC;IACzB,CAAC,MAAM;MACNQ,UAAU,CAAER,IAAK,CAAC;IACnB;EACD,CAAC;EAEDhB,MAAM,CAACuB,UAAU,GAAKK,IAAI,IAAM;IAC/B,MAAMZ,IAAI,GAAGY,IAAI,CAACC,OAAO,CAAE,YAAa,CAAC;IAEzC,IAAKb,IAAI,IAAI,IAAAW,cAAK,EAAEX,IAAK,CAAC,EAAG;MAC5BN,QAAQ,CAAEV,MAAM,EAAEgB,IAAK,CAAC;IACzB,CAAC,MAAM;MACNO,UAAU,CAAEK,IAAK,CAAC;IACnB;EACD,CAAC;EAED,OAAO5B,MAAM;AACd,CAAC;AAAC8B,OAAA,CAAAR,SAAA,GAAAA,SAAA","ignoreList":[]}