{"version":3,"names":["_slateHyperscript","require","_slate","_autop","_createEditor","_interopRequireDefault","deserializeHTML","htmlString","normalize","deserialize","DOMParser","parseFromString","formatBeforeDeserializing","autop","body","val","editor","createEditor","children","Editor","force","value","$value","replace","el","TEXT_TAGS","EM","italic","I","STRONG","bold","ELEMENT_TAGS","P","type","MERGETAG","data","dataset","modifier","text","underline","A","url","getAttribute","nodeType","Node","TEXT_NODE","textContent","undefined","nodeName","parent","Array","from","childNodes","map","flat","descendants","length","jsx","attrs","child","_default","exports","default"],"sources":["@quillforms/admin-components/src/rich-text/html-deserialize.ts"],"sourcesContent":["/**\n * External Dependencies\n */\nimport { jsx } from 'slate-hyperscript';\nimport { Editor, Node as SlateNode, Descendant, Text } from 'slate';\nimport { autop } from '@wordpress/autop';\n\n/**\n * Internal Dependencies\n */\nimport createEditor from './create-editor';\nimport { MergeTag } from './types';\n\nconst deserializeHTML = ( htmlString: string ): SlateNode[] => {\n\treturn normalize(\n\t\tdeserialize(\n\t\t\tnew DOMParser().parseFromString(\n\t\t\t\tformatBeforeDeserializing( autop( htmlString ) ),\n\t\t\t\t'text/html'\n\t\t\t).body\n\t\t)\n\t);\n};\n\n// Normalize to fix invalid JSON that may result from deserializing\n// This custom normalizer should be called one time only after the component mounting\nconst normalize = ( val: SlateNode[] ): SlateNode[] => {\n\t// Create temp editor for normalizing\n\tconst editor = createEditor();\n\teditor.children = val;\n\tEditor.normalize( editor, { force: true } );\n\treturn editor.children;\n};\n\nconst formatBeforeDeserializing = ( value: string ): string => {\n\tif ( ! value ) {\n\t\treturn '<p></p>';\n\t}\n\tconst $value = value.replace(\n\t\t/{{([a-zA-Z0-9-_]+):([a-zA-Z0-9-_]+)}}/g,\n\t\t\"<mergetag data-type='$1' data-modifier='$2'>_____</mergetag>\"\n\t);\n\treturn $value;\n};\n\nconst deserialize = ( el: HTMLElement | ChildNode ) => {\n\tconst TEXT_TAGS = {\n\t\t// CODE: () => ({ code: true }),\n\t\t// DEL: () => ({ strikethrough: true }),\n\t\tEM: () => ( { italic: true } ),\n\t\tI: () => ( { italic: true } ),\n\t\t// S: () => ({ strikethrough: true }),\n\t\tSTRONG: () => ( { bold: true } ),\n\t};\n\tconst ELEMENT_TAGS = {\n\t\tP: () => ( { type: 'paragraph' } ),\n\t\tMERGETAG: () => ( {\n\t\t\ttype: 'mergeTag',\n\t\t\tdata: {\n\t\t\t\ttype: ( ( el as HTMLElement ).dataset as MergeTag ).type,\n\t\t\t\tmodifier: ( ( el as HTMLElement ).dataset as MergeTag )\n\t\t\t\t\t.modifier,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\ttext: '',\n\t\t\t\t\tbold: false,\n\t\t\t\t\titalic: false,\n\t\t\t\t\tunderline: false,\n\t\t\t\t},\n\t\t\t],\n\t\t} ),\n\t\tA: () => ( {\n\t\t\ttype: 'link',\n\t\t\turl: ( el as HTMLElement ).getAttribute( 'href' ),\n\t\t} ),\n\n\t\t// H1: () => ({ type: \"heading-one\" }),\n\t\t// H2: () => ({ type: \"heading-two\" }),\n\t\t// BLOCKQUOTE: () => ({ type: \"quote\" }),\n\t\t// LI: () => ({ type: \"list-item\" }),\n\t\t// OL: () => ({ type: \"numbered-list\" }),\n\t\t// UL: () => ({ type: \"bulleted-list\" }),\n\t\t// IMG: el => ({ type: \"image\", url: el.getAttribute(\"src\") })\n\t};\n\n\tif ( el.nodeType === Node.TEXT_NODE ) {\n\t\tif ( el.textContent !== '\\n' ) {\n\t\t\treturn el.textContent;\n\t\t}\n\t}\n\tif ( el.nodeType !== 1 ) {\n\t\treturn undefined;\n\t}\n\tif ( el.nodeName === 'BR' ) {\n\t\treturn '\\n';\n\t}\n\n\tconst { nodeName } = el;\n\tlet parent = el;\n\n\t// if (\n\t// \tnodeName === 'PRE' &&\n\t// \tel.childNodes[ 0 ] &&\n\t// \tel.childNodes[ 0 ].nodeName === 'CODE'\n\t// ) {\n\t// \t[ parent ] = el.childNodes;\n\t// }\n\n\tconst children = Array.from( parent.childNodes ).map( deserialize ).flat();\n\n\tlet descendants = children as Descendant[];\n\tif ( ! descendants.length ) {\n\t\tdescendants = [ { text: '' } ];\n\t}\n\n\tif ( el.nodeName === 'BODY' ) {\n\t\treturn jsx( 'fragment', descendants );\n\t}\n\n\tif ( ELEMENT_TAGS[ nodeName ] ) {\n\t\tconst attrs = ELEMENT_TAGS[ nodeName ]( el );\n\n\t\treturn jsx( 'element', { ...attrs }, descendants );\n\t}\n\n\tif ( TEXT_TAGS[ nodeName ] ) {\n\t\tconst attrs = TEXT_TAGS[ nodeName ]( el );\n\t\treturn children.map( ( child: Descendant ): void | Text => {\n\t\t\t// This condition is to prevent throwing error when we have a string like this: <strong> {{type:modifier}} </strong>\n\t\t\tif ( child?.type !== 'mergeTag' ) {\n\t\t\t\treturn jsx( 'text', { ...attrs }, child );\n\t\t\t}\n\t\t} );\n\t}\n\n\treturn children;\n};\n\nexport default deserializeHTML;\n"],"mappings":"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","ignoreList":[]}