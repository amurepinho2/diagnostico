{"version":3,"names":["_react","require","_reactWindow","_lodash","_choicesContext","_choiceWrapper","_interopRequireDefault","_choiceRow","_dragDropContext","_droppable","_generateChoiceId","ChoicesInserter","choices","setChoices","withAttachment","labelChangeHandler","val","index","$choices","cloneDeep","label","addChoice","at","splice","value","generateChoiceId","deleteChoice","newChoices","filter","choice","deleteImageHandler","imageUrl","undefined","handleMediaUpload","media","url","context","createElement","default","onDragEnd","result","source","destination","sourceIndex","destinationIndex","output","Array","from","removed","ChoiceContextProvider","useMemo","Object","values","droppableId","mode","renderClone","provided","_snapshot","rubric","draggableProps","dragHandleProps","ref","innerRef","style","zIndex","snapshot","itemCount","isUsingPlaceholder","length","droppableProps","FixedSizeList","className","outerRef","height","width","itemSize","itemData","ChoiceWrapper","_default","exports"],"sources":["@quillforms/admin-components/src/choices-inserter/index.tsx"],"sourcesContent":["/**\n * WordPress Dependencies\n */\nimport { useMemo } from 'react';\n\n/**\n * External Dependencies\n */\nimport { FixedSizeList as List } from 'react-window';\nimport { cloneDeep } from 'lodash';\n\n/**\n * Internal Dependencies\n */\nimport { ChoiceContextProvider } from './choices-context';\nimport ChoiceWrapper from './choice-wrapper';\nimport ChoiceRow from './choice-row';\nimport __experimentalDragDropContext from '../drag-drop-context';\nimport __experimentalDroppable from '../droppable';\nimport generateChoiceId from './generate-choice-id';\nimport type { Choices } from '../choices-bulk-btn/types';\n\ninterface Props {\n\tchoices: Choices;\n\tsetChoices: ( choices: Choices ) => void;\n\twithAttachment: boolean;\n}\nconst ChoicesInserter: React.FC< Props > = ( {\n\tchoices,\n\tsetChoices,\n\twithAttachment,\n} ) => {\n\tconst labelChangeHandler = ( val: string, index: number ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices[ index ] = { ...$choices[ index ], label: val };\n\t\tsetChoices( $choices );\n\t};\n\n\tconst addChoice = ( at: number ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices.splice( at, 0, {\n\t\t\tvalue: generateChoiceId(),\n\t\t\tlabel: '',\n\t\t} );\n\t\tsetChoices( $choices );\n\t};\n\n\tconst deleteChoice = ( value: string ) => {\n\t\tconst newChoices = cloneDeep( choices ).filter(\n\t\t\t( choice ) => choice.value !== value\n\t\t);\n\t\tsetChoices( newChoices );\n\t};\n\n\tconst deleteImageHandler = ( index ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices[ index ].imageUrl = undefined;\n\t\tsetChoices( $choices );\n\t};\n\tconst handleMediaUpload = ( media, index ) => {\n\t\tconst $choices = cloneDeep( choices );\n\t\t$choices[ index ].imageUrl = media.url;\n\t\tsetChoices( $choices );\n\t};\n\n\tconst context = {\n\t\taddChoice,\n\t\tlabelChangeHandler,\n\t\tdeleteChoice,\n\t\tdeleteImageHandler,\n\t\thandleMediaUpload,\n\t\twithAttachment,\n\t};\n\n\treturn (\n\t\t<__experimentalDragDropContext\n\t\t\tonDragEnd={ ( result ) => {\n\t\t\t\tconst { source, destination } = result;\n\t\t\t\tif (\n\t\t\t\t\t! result.destination ||\n\t\t\t\t\tresult.source.index === result.destination.index\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst sourceIndex = source.index;\n\t\t\t\tconst destinationIndex = destination?.index;\n\t\t\t\tconst $choices = [ ...choices ];\n\t\t\t\tconst output = Array.from( $choices );\n\t\t\t\tconst [ removed ] = output.splice( sourceIndex, 1 );\n\t\t\t\tif ( destinationIndex !== undefined ) {\n\t\t\t\t\toutput.splice( destinationIndex, 0, removed );\n\t\t\t\t\tsetChoices( output );\n\t\t\t\t}\n\t\t\t} }\n\t\t>\n\t\t\t<ChoiceContextProvider\n\t\t\t\t// It is important to return the same object if props haven't\n\t\t\t\t// changed to avoid  unnecessary rerenders.\n\t\t\t\t// See https://reactjs.org/docs/context.html#caveats.\n\t\t\t\tvalue={ useMemo( () => context, Object.values( context ) ) }\n\t\t\t>\n\t\t\t\t<__experimentalDroppable\n\t\t\t\t\tdroppableId=\"CHOICES_DROP_AREA\"\n\t\t\t\t\tmode=\"virtual\"\n\t\t\t\t\trenderClone={ ( provided, _snapshot, rubric ) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t{ ...provided.draggableProps }\n\t\t\t\t\t\t\t\t{ ...provided.dragHandleProps }\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\t...provided.draggableProps.style,\n\t\t\t\t\t\t\t\t\tzIndex: 111111111,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ChoiceRow\n\t\t\t\t\t\t\t\t\tchoices={ choices }\n\t\t\t\t\t\t\t\t\tindex={ rubric.source.index }\n\t\t\t\t\t\t\t\t\tprovided={ provided }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t{ ( provided, snapshot ) => {\n\t\t\t\t\t\tconst itemCount = snapshot.isUsingPlaceholder\n\t\t\t\t\t\t\t? choices.length + 1\n\t\t\t\t\t\t\t: choices.length;\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tref={ provided.innerRef }\n\t\t\t\t\t\t\t\t{ ...provided.droppableProps }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<List\n\t\t\t\t\t\t\t\t\tclassName=\"admin-components-choices-inserter__choices-wrapper\"\n\t\t\t\t\t\t\t\t\touterRef={ provided.innerRef }\n\t\t\t\t\t\t\t\t\theight={ 250 }\n\t\t\t\t\t\t\t\t\twidth={ '100%' }\n\t\t\t\t\t\t\t\t\titemCount={ itemCount }\n\t\t\t\t\t\t\t\t\titemSize={ 54 }\n\t\t\t\t\t\t\t\t\titemData={ choices }\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ ChoiceWrapper }\n\t\t\t\t\t\t\t\t</List>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t} }\n\t\t\t\t</__experimentalDroppable>\n\t\t\t</ChoiceContextProvider>\n\t\t</__experimentalDragDropContext>\n\t);\n};\n\nexport default ChoicesInserter;\n"],"mappings":"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","ignoreList":[]}