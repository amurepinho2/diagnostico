{"version":3,"names":["useEffect","useState","useSelect","useDispatch","doAction","removep","cloneDeep","map","omit","size","useEditableFields","FormFlow","useBlocks","useFormContext","useFormSettings","FormWrapper","applyLogic","isMounted","setIsMounted","editableFields","currentBlockId","blockTypes","select","getCurrentBlockId","getBlockTypes","blocks","isPreview","formObj","hiddenFields","formId","saveAnswersInBrowser","setSwiper","insertEmptyFieldAnswer","goToBlock","setPaymentData","setFieldAnswer","replaceHiddenFields","val","newVal","replace","_match","p1","forEach","field","attributes","defaultValue","blockType","name","supports","numeric","id","getNumericVal","welcomeScreens","filter","block","thankyouScreens","walkPath","JSON","stringify","firstBlock","undefined","urlParams","window","URLSearchParams","location","search","isPaymentStep","get","formCompleted","_ref","_window$pending_submi","pending_submission","thankyou_screen_id","setTimeout","createElement"],"sources":["@quillforms/renderer-core/src/components/form-wrapper/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { useEffect, useState } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { doAction } from '@wordpress/hooks';\r\nimport { removep } from \"@wordpress/autop\";\r\n\r\n/** \r\n * External Dependencies\r\n */\r\nimport { cloneDeep, map, omit, size } from 'lodash';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport useEditableFields from '../../hooks/use-editable-fields';\r\nimport FormFlow from '../form-flow';\r\nimport useBlocks from '../../hooks/use-blocks';\r\nimport type { Screen } from '../../store/types';\r\nimport useFormContext from '../../hooks/use-form-context';\r\nimport { useFormSettings } from '../../hooks';\r\n\r\ninterface Props {\r\n\tapplyLogic: boolean;\r\n}\r\nconst FormWrapper: React.FC<Props> = ({ applyLogic }) => {\r\n\tconst [isMounted, setIsMounted] = useState(false);\r\n\tconst editableFields = useEditableFields(true);\r\n\tconst { currentBlockId, blockTypes } = useSelect((select) => {\r\n\t\treturn {\r\n\t\t\tcurrentBlockId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getCurrentBlockId(),\r\n\t\t\tblockTypes: select('quillForms/blocks').getBlockTypes(),\r\n\t\t};\r\n\t});\r\n\tconst blocks = useBlocks();\r\n\tconst {\r\n\t\tisPreview,\r\n\t\tformObj: { hiddenFields },\r\n\t\tformId\r\n\t} = useFormContext();\r\n\tconst { saveAnswersInBrowser } = useFormSettings();\r\n\tconst {\r\n\t\tsetSwiper,\r\n\t\tinsertEmptyFieldAnswer,\r\n\t\tgoToBlock,\r\n\t\tsetPaymentData,\r\n\t\tsetFieldAnswer,\r\n\t} = useDispatch('quillForms/renderer-core');\r\n\r\n\tconst replaceHiddenFields = (val) => {\r\n\t\tconst newVal = val.replace(\r\n\t\t\t/{{hidden_field:([a-zA-Z0-9-_]+)}}/g,\r\n\t\t\t(_match, p1) => {\r\n\t\t\t\tif (size(hiddenFields) > 0 && hiddenFields?.[p1]) {\r\n\t\t\t\t\treturn hiddenFields[p1];\r\n\t\t\t\t}\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn newVal;\r\n\t};\r\n\tuseEffect(() => {\r\n\t\tif (!isPreview) {\r\n\t\t\teditableFields.forEach((field) => {\r\n\t\t\t\tif (field?.attributes?.defaultValue) {\r\n\t\t\t\t\tconst blockType = blockTypes[field.name];\r\n\t\t\t\t\tif (blockType?.supports?.numeric) {\r\n\t\t\t\t\t\tsetFieldAnswer(\r\n\t\t\t\t\t\t\tfield.id,\r\n\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\tblockType?.getNumericVal(\r\n\t\t\t\t\t\t\t\treplaceHiddenFields(\r\n\t\t\t\t\t\t\t\t\tremovep(field.attributes.defaultValue)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetFieldAnswer(\r\n\t\t\t\t\t\t\tfield.id,\r\n\t\t\t\t\t\t\treplaceHiddenFields(removep(field.attributes.defaultValue))\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinsertEmptyFieldAnswer(field.id, field.name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst welcomeScreens = map(\r\n\t\t\t\tcloneDeep(blocks).filter(\r\n\t\t\t\t\t(block) => block.name === 'welcome-screen'\r\n\t\t\t\t),\r\n\t\t\t\t(block) => omit(block, ['name'])\r\n\t\t\t) as [] | Screen[];\r\n\r\n\t\t\tconst thankyouScreens = map(\r\n\t\t\t\tcloneDeep(blocks).filter(\r\n\t\t\t\t\t(block) => block.name === 'thankyou-screen'\r\n\t\t\t\t),\r\n\t\t\t\t(block) => omit(block, ['name'])\r\n\t\t\t) as [] | Screen[];\r\n\t\t\tsetSwiper({\r\n\t\t\t\twalkPath: cloneDeep(\r\n\t\t\t\t\tblocks.filter(\r\n\t\t\t\t\t\t(block) =>\r\n\t\t\t\t\t\t\tblock.name !== 'thankyou-screen' &&\r\n\t\t\t\t\t\t\tblock.name !== 'welcome-screen'\r\n\t\t\t\t\t)\r\n\t\t\t\t),\r\n\t\t\t\twelcomeScreens:\r\n\t\t\t\t\tsize(welcomeScreens) === 0\r\n\t\t\t\t\t\t? []\r\n\t\t\t\t\t\t: (welcomeScreens as Screen[]),\r\n\t\t\t\tthankyouScreens:\r\n\t\t\t\t\tsize(thankyouScreens) === 0\r\n\t\t\t\t\t\t? []\r\n\t\t\t\t\t\t: (thankyouScreens as Screen[]),\r\n\t\t\t});\r\n\t\t\tif (!applyLogic && !isPreview) {\r\n\t\t\t\tif (currentBlockId) goToBlock(currentBlockId, true);\r\n\t\t\t}\r\n\t\t\tsetIsMounted(true);\r\n\t\t}\r\n\t}, [JSON.stringify(blocks)]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (isMounted) {\r\n\t\t\tconst firstBlock = blocks && blocks[0] ? blocks[0] : undefined;\r\n\r\n\t\t\tconst urlParams =\r\n\t\t\t\ttypeof window !== 'undefined'\r\n\t\t\t\t\t? new URLSearchParams(window.location.search)\r\n\t\t\t\t\t: undefined;\r\n\t\t\tconst isPaymentStep = urlParams?.get('step') === 'payment';\r\n\r\n\t\t\tlet formCompleted = false;\r\n\t\t\tif (isPaymentStep) {\r\n\t\t\t\tdoAction(\r\n\t\t\t\t\t'QuillForms.RendererCore.PaymentStep',\r\n\t\t\t\t\turlParams,\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tformCompleted = true;\r\n\t\t\t\t\t\tgoToBlock(\r\n\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\twindow?.pending_submission?.thankyou_screen_id ??\r\n\t\t\t\t\t\t\turlParams.get('thankyou_screen_id') ??\r\n\t\t\t\t\t\t\t'default_thankyou_screen'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\t// @ts-expect-error.\r\n\t\t\t\t\t\tsetPaymentData(window?.pending_submission);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (!formCompleted) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (firstBlock?.id) {\r\n\t\t\t\t\t\tgoToBlock(firstBlock.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [isMounted]);\r\n\r\n\treturn <FormFlow applyLogic={applyLogic} />;\r\n};\r\n\r\nexport default FormWrapper;\r\n"],"mappings":"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","ignoreList":[]}