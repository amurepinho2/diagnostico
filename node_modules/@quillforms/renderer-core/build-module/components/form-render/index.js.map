{"version":3,"names":["sanitizeBlocks","getDefaultMessages","useState","useEffect","doAction","FormContextProvider","FormWrapper","map","shuffle","size","Form","formObj","formId","onSubmit","applyLogic","beforeGoingNext","isPreview","customFonts","deviceWidth","setDeviceWidth","handleResize","window","innerWidth","addEventListener","removeEventListener","formatFormObj","blocks","messages","ParsedUrlSearch","URLSearchParams","location","search","substring","settings","disableProgressBar","disableWheelSwiping","disableNavigationArrows","animationDirection","showQuestionsNumbers","showLettersOnAnswers","saveAnswersInBrowser","displayBranding","correctIncorrectQuiz","enabled","questions","showAnswersDuringQuiz","$block","name","attributes","randomize","_$block$attributes$ch","choices","get","createElement","value"],"sources":["@quillforms/renderer-core/src/components/form-render/index.tsx"],"sourcesContent":["/**\r\n * QuillForms Dependencies\r\n */\r\nimport { sanitizeBlocks } from '@quillforms/blocks';\r\nimport { getDefaultMessages } from '@quillforms/utils';\r\n\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useState, useEffect } from '@wordpress/element';\r\nimport { doAction } from '@wordpress/hooks';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport { FormContextProvider } from '../form-context';\r\nimport FormWrapper from '../form-wrapper';\r\nimport type { FormObj, SubmissionDispatchers, CustomFont } from '../../types';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { map, shuffle, size } from 'lodash';\r\n\r\ninterface Props {\r\n\tformId?: number;\r\n\tformObj: FormObj;\r\n\tcustomFonts?: CustomFont[];\r\n\tonSubmit: (data: Object, dispatchers: SubmissionDispatchers) => void;\r\n\tbeforeGoingNext?: ({\r\n\t\tsetIsFieldValid,\r\n\t\tsetIsPending,\r\n\t\tcurrentBlockId,\r\n\t\tanswers,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\tgoToBlock,\r\n\t\tgoNext,\r\n\t}: {\r\n\t\tsetIsFieldValid: (id: string, flag: boolean) => void;\r\n\t\tsetFieldValidationErr: (id: string, err: string) => void;\r\n\t\tsetIsPending: (flag: boolean) => void;\r\n\t\tsetIsCurrentBlockSafeToSwipe: (flag: boolean) => void;\r\n\t\tgoToBlock: (id: string) => void;\r\n\t\tgoNext: () => void;\r\n\t\tcurrentBlockId: string;\r\n\t\tanswers: Record<string, unknown>;\r\n\t}) => void;\r\n\tapplyLogic: boolean;\r\n\tisPreview?: boolean;\r\n}\r\nconst Form: React.FC<Props> = ({\r\n\tformObj,\r\n\tformId,\r\n\tonSubmit,\r\n\tapplyLogic = false,\r\n\tbeforeGoingNext,\r\n\tisPreview = false,\r\n\tcustomFonts\r\n}) => {\r\n\tconst [deviceWidth, setDeviceWidth] = useState('');\r\n\r\n\tuseEffect(() => {\r\n\t\tfunction handleResize() {\r\n\t\t\tif (window.innerWidth < 600) {\r\n\t\t\t\tsetDeviceWidth('mobile');\r\n\t\t\t} else {\r\n\t\t\t\tsetDeviceWidth('desktop');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('resize', handleResize);\r\n\t\thandleResize();\r\n\r\n\t\treturn () => window.removeEventListener('resize', handleResize);\r\n\t}, []);\r\n\r\n\tconst formatFormObj = (): FormObj => {\r\n\t\t// If not in preview mode, sanitize blocks.\r\n\t\t// In preview mode, sanitizing is already done in block editor resolvers.\r\n\t\tif (!isPreview) {\r\n\t\t\tformObj.blocks = sanitizeBlocks(formObj.blocks);\r\n\t\t}\r\n\r\n\t\tformObj.messages = {\r\n\t\t\t...getDefaultMessages(),\r\n\t\t\t...formObj.messages,\r\n\t\t};\r\n\t\tconst ParsedUrlSearch =\r\n\t\t\ttypeof window !== 'undefined'\r\n\t\t\t\t? new URLSearchParams(\r\n\t\t\t\t\twindow?.location?.search?.substring(1)\r\n\t\t\t\t)\r\n\t\t\t\t: '';\r\n\t\tif (!formObj.settings) formObj.settings = {};\r\n\t\tformObj.settings = {\r\n\t\t\tdisableProgressBar: false,\r\n\t\t\tdisableWheelSwiping: false,\r\n\t\t\tdisableNavigationArrows: false,\r\n\t\t\tanimationDirection: 'vertical',\r\n\t\t\tshowQuestionsNumbers: true,\r\n\t\t\tshowLettersOnAnswers: true,\r\n\t\t\tsaveAnswersInBrowser: false,\r\n\t\t\tdisplayBranding: false,\r\n\t\t\t...formObj.settings,\r\n\t\t};\r\n\r\n\t\tformObj.correctIncorrectQuiz = {\r\n\t\t\tenabled: false,\r\n\t\t\tquestions: {},\r\n\t\t\tshowAnswersDuringQuiz: true,\r\n\t\t\t...formObj.correctIncorrectQuiz,\r\n\r\n\t\t}\r\n\r\n\t\tformObj.blocks = map(formObj.blocks, ($block) => {\r\n\t\t\tif (\r\n\t\t\t\t(\r\n\t\t\t\t\t$block.name === 'multiple-choice' ||\r\n\t\t\t\t\t$block.name === 'dropdown' ||\r\n\t\t\t\t\t$block.name === 'picture-choice'\r\n\t\t\t\t) &&\r\n\t\t\t\t$block?.attributes?.randomize\r\n\t\t\t\t&& !isPreview\r\n\t\t\t) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...$block,\r\n\t\t\t\t\tattributes: {\r\n\t\t\t\t\t\t...$block.attributes,\r\n\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\tchoices: shuffle($block?.attributes?.choices ?? [])\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn $block;\r\n\t\t})\r\n\r\n\t\t// 'quillforms-redirection' is deprecated and will be removed.\r\n\t\tif (\r\n\t\t\tsize(ParsedUrlSearch) > 0 &&\r\n\t\t\t// @ts-expect-error\r\n\t\t\tParsedUrlSearch?.get('quillforms-shortcode')\r\n\t\t) {\r\n\t\t\tformObj.settings.disableWheelSwiping = true;\r\n\t\t}\r\n\t\treturn formObj;\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!isPreview) {\r\n\t\t\tdoAction('QuillForms.RendererCore.Loaded');\r\n\t\t}\r\n\t}, []);\r\n\r\n\treturn (\r\n\t\t<FormContextProvider\r\n\t\t\tvalue={{\r\n\t\t\t\tformObj: formatFormObj(),\r\n\t\t\t\tonSubmit,\r\n\t\t\t\tisPreview,\r\n\t\t\t\tformId,\r\n\t\t\t\tbeforeGoingNext,\r\n\t\t\t\tdeviceWidth,\r\n\t\t\t\tcustomFonts\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<FormWrapper applyLogic={applyLogic} />\r\n\t\t</FormContextProvider>\r\n\t);\r\n};\r\n\r\nexport default Form;\r\n"],"mappings":"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","ignoreList":[]}