{"version":3,"names":["useEffect","findDOMNode","useSelect","focusTimer","useHandleFocus","inputRef","isActive","isTouchScreen","isAnimating","currentBlockId","select","getCurrentBlockId","isFocused","isVisible","ref","current","inputElement","rect","getBoundingClientRect","top","left","bottom","window","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","setTimeout","focus","el","querySelector","activeElement","clearTimeout","blur"],"sources":["@quillforms/renderer-core/src/hooks/use-handle-focus.ts"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { useEffect, findDOMNode } from '@wordpress/element';\r\nimport { useSelect } from '@wordpress/data';\r\n\r\nlet focusTimer;\r\nconst useHandleFocus = (\r\n\tinputRef,\r\n\tisActive: boolean,\r\n\tisTouchScreen: boolean\r\n) => {\r\n\tconst { isAnimating, currentBlockId } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tisAnimating: select( 'quillForms/renderer-core' ).isAnimating(),\r\n\t\t\tcurrentBlockId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getCurrentBlockId(),\r\n\t\t};\r\n\t} );\r\n\r\n\tconst { isFocused } = useSelect( ( select ) => {\r\n\t\treturn {\r\n\t\t\tisFocused: select( 'quillForms/renderer-core' ).isFocused(),\r\n\t\t};\r\n\t} );\r\n\r\n\tconst isVisible = ( ref ) => {\r\n\t\tif ( ! ref?.current ) return false;\r\n\t\tconst current = ref?.current?.inputElement\r\n\t\t\t? ref.current.inputElement\r\n\t\t\t: ref.current;\r\n\t\tconst rect = (\r\n\t\t\tfindDOMNode( current ) as Element\r\n\t\t )?.getBoundingClientRect();\r\n\r\n\t\treturn (\r\n\t\t\trect.top >= 0 &&\r\n\t\t\trect.left >= 0 &&\r\n\t\t\trect.bottom <=\r\n\t\t\t\t( window.innerHeight ||\r\n\t\t\t\t\tdocument.documentElement\r\n\t\t\t\t\t\t.clientHeight ) /* or $(window).height() */ &&\r\n\t\t\trect.right <=\r\n\t\t\t\t( window.innerWidth ||\r\n\t\t\t\t\tdocument.documentElement\r\n\t\t\t\t\t\t.clientWidth ) /* or $(window).width() */\r\n\t\t);\r\n\t};\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! isTouchScreen && isFocused && isActive && ! isAnimating ) {\r\n\t\t\tif ( isVisible( inputRef ) ) {\r\n\t\t\t\tfocusTimer = setTimeout( () => {\r\n\t\t\t\t\tif ( inputRef?.current?.focus ) {\r\n\t\t\t\t\t\tinputRef.current.focus();\r\n\t\t\t\t\t} else if ( inputRef?.current?.inputElement?.focus ) {\r\n\t\t\t\t\t\tinputRef.current.inputElement.focus();\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 30 );\r\n\t\t\t} else if ( currentBlockId ) {\r\n\t\t\t\tconst el = document?.querySelector(\r\n\t\t\t\t\t`#block-${ currentBlockId } .renderer-components-field-wrapper__content-wrapper`\r\n\t\t\t\t) as HTMLElement;\r\n\r\n\t\t\t\tfocusTimer = setTimeout( () => {\r\n\t\t\t\t\tif ( document.activeElement !== el ) el.focus();\r\n\t\t\t\t}, 50 );\r\n\t\t\t}\r\n\t\t}\r\n\t}, [ isFocused, isActive, isAnimating ] );\r\n\r\n\tuseEffect( () => {\r\n\t\tif ( ! isActive ) {\r\n\t\t\tclearTimeout( focusTimer );\r\n\t\t}\r\n\t\tif (\r\n\t\t\tinputRef?.current?.blur &&\r\n\t\t\t! isActive &&\r\n\t\t\tdocument.activeElement === inputRef.current\r\n\t\t) {\r\n\t\t\tinputRef.current.blur();\r\n\t\t}\r\n\t}, [ inputRef, isActive ] );\r\n};\r\n\r\nexport default useHandleFocus;\r\n"],"mappings":"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","ignoreList":[]}