{"version":3,"names":["_element","require","_data","_hooks","_autop","_lodash","_useEditableFields","_interopRequireDefault","_formFlow","_useBlocks","_useFormContext","_hooks2","FormWrapper","applyLogic","isMounted","setIsMounted","useState","editableFields","useEditableFields","currentBlockId","blockTypes","useSelect","select","getCurrentBlockId","getBlockTypes","blocks","useBlocks","isPreview","formObj","hiddenFields","formId","useFormContext","saveAnswersInBrowser","useFormSettings","setSwiper","insertEmptyFieldAnswer","goToBlock","setPaymentData","setFieldAnswer","useDispatch","replaceHiddenFields","val","newVal","replace","_match","p1","size","useEffect","forEach","field","attributes","defaultValue","blockType","name","supports","numeric","id","getNumericVal","removep","welcomeScreens","map","cloneDeep","filter","block","omit","thankyouScreens","walkPath","JSON","stringify","firstBlock","undefined","urlParams","window","URLSearchParams","location","search","isPaymentStep","get","formCompleted","doAction","_ref","_window$pending_submi","pending_submission","thankyou_screen_id","setTimeout","_react","createElement","default","_default","exports"],"sources":["@quillforms/renderer-core/src/components/form-wrapper/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { useEffect, useState } from '@wordpress/element';\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { doAction } from '@wordpress/hooks';\r\nimport { removep } from \"@wordpress/autop\";\r\n\r\n/** \r\n * External Dependencies\r\n */\r\nimport { cloneDeep, map, omit, size } from 'lodash';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport useEditableFields from '../../hooks/use-editable-fields';\r\nimport FormFlow from '../form-flow';\r\nimport useBlocks from '../../hooks/use-blocks';\r\nimport type { Screen } from '../../store/types';\r\nimport useFormContext from '../../hooks/use-form-context';\r\nimport { useFormSettings } from '../../hooks';\r\n\r\ninterface Props {\r\n\tapplyLogic: boolean;\r\n}\r\nconst FormWrapper: React.FC<Props> = ({ applyLogic }) => {\r\n\tconst [isMounted, setIsMounted] = useState(false);\r\n\tconst editableFields = useEditableFields(true);\r\n\tconst { currentBlockId, blockTypes } = useSelect((select) => {\r\n\t\treturn {\r\n\t\t\tcurrentBlockId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getCurrentBlockId(),\r\n\t\t\tblockTypes: select('quillForms/blocks').getBlockTypes(),\r\n\t\t};\r\n\t});\r\n\tconst blocks = useBlocks();\r\n\tconst {\r\n\t\tisPreview,\r\n\t\tformObj: { hiddenFields },\r\n\t\tformId\r\n\t} = useFormContext();\r\n\tconst { saveAnswersInBrowser } = useFormSettings();\r\n\tconst {\r\n\t\tsetSwiper,\r\n\t\tinsertEmptyFieldAnswer,\r\n\t\tgoToBlock,\r\n\t\tsetPaymentData,\r\n\t\tsetFieldAnswer,\r\n\t} = useDispatch('quillForms/renderer-core');\r\n\r\n\tconst replaceHiddenFields = (val) => {\r\n\t\tconst newVal = val.replace(\r\n\t\t\t/{{hidden_field:([a-zA-Z0-9-_]+)}}/g,\r\n\t\t\t(_match, p1) => {\r\n\t\t\t\tif (size(hiddenFields) > 0 && hiddenFields?.[p1]) {\r\n\t\t\t\t\treturn hiddenFields[p1];\r\n\t\t\t\t}\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn newVal;\r\n\t};\r\n\tuseEffect(() => {\r\n\t\tif (!isPreview) {\r\n\t\t\teditableFields.forEach((field) => {\r\n\t\t\t\tif (field?.attributes?.defaultValue) {\r\n\t\t\t\t\tconst blockType = blockTypes[field.name];\r\n\t\t\t\t\tif (blockType?.supports?.numeric) {\r\n\t\t\t\t\t\tsetFieldAnswer(\r\n\t\t\t\t\t\t\tfield.id,\r\n\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\tblockType?.getNumericVal(\r\n\t\t\t\t\t\t\t\treplaceHiddenFields(\r\n\t\t\t\t\t\t\t\t\tremovep(field.attributes.defaultValue)\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetFieldAnswer(\r\n\t\t\t\t\t\t\tfield.id,\r\n\t\t\t\t\t\t\treplaceHiddenFields(removep(field.attributes.defaultValue))\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinsertEmptyFieldAnswer(field.id, field.name);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tconst welcomeScreens = map(\r\n\t\t\t\tcloneDeep(blocks).filter(\r\n\t\t\t\t\t(block) => block.name === 'welcome-screen'\r\n\t\t\t\t),\r\n\t\t\t\t(block) => omit(block, ['name'])\r\n\t\t\t) as [] | Screen[];\r\n\r\n\t\t\tconst thankyouScreens = map(\r\n\t\t\t\tcloneDeep(blocks).filter(\r\n\t\t\t\t\t(block) => block.name === 'thankyou-screen'\r\n\t\t\t\t),\r\n\t\t\t\t(block) => omit(block, ['name'])\r\n\t\t\t) as [] | Screen[];\r\n\t\t\tsetSwiper({\r\n\t\t\t\twalkPath: cloneDeep(\r\n\t\t\t\t\tblocks.filter(\r\n\t\t\t\t\t\t(block) =>\r\n\t\t\t\t\t\t\tblock.name !== 'thankyou-screen' &&\r\n\t\t\t\t\t\t\tblock.name !== 'welcome-screen'\r\n\t\t\t\t\t)\r\n\t\t\t\t),\r\n\t\t\t\twelcomeScreens:\r\n\t\t\t\t\tsize(welcomeScreens) === 0\r\n\t\t\t\t\t\t? []\r\n\t\t\t\t\t\t: (welcomeScreens as Screen[]),\r\n\t\t\t\tthankyouScreens:\r\n\t\t\t\t\tsize(thankyouScreens) === 0\r\n\t\t\t\t\t\t? []\r\n\t\t\t\t\t\t: (thankyouScreens as Screen[]),\r\n\t\t\t});\r\n\t\t\tif (!applyLogic && !isPreview) {\r\n\t\t\t\tif (currentBlockId) goToBlock(currentBlockId, true);\r\n\t\t\t}\r\n\t\t\tsetIsMounted(true);\r\n\t\t}\r\n\t}, [JSON.stringify(blocks)]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (isMounted) {\r\n\t\t\tconst firstBlock = blocks && blocks[0] ? blocks[0] : undefined;\r\n\r\n\t\t\tconst urlParams =\r\n\t\t\t\ttypeof window !== 'undefined'\r\n\t\t\t\t\t? new URLSearchParams(window.location.search)\r\n\t\t\t\t\t: undefined;\r\n\t\t\tconst isPaymentStep = urlParams?.get('step') === 'payment';\r\n\r\n\t\t\tlet formCompleted = false;\r\n\t\t\tif (isPaymentStep) {\r\n\t\t\t\tdoAction(\r\n\t\t\t\t\t'QuillForms.RendererCore.PaymentStep',\r\n\t\t\t\t\turlParams,\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tformCompleted = true;\r\n\t\t\t\t\t\tgoToBlock(\r\n\t\t\t\t\t\t\t// @ts-expect-error\r\n\t\t\t\t\t\t\twindow?.pending_submission?.thankyou_screen_id ??\r\n\t\t\t\t\t\t\turlParams.get('thankyou_screen_id') ??\r\n\t\t\t\t\t\t\t'default_thankyou_screen'\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t},\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\t// @ts-expect-error.\r\n\t\t\t\t\t\tsetPaymentData(window?.pending_submission);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (!formCompleted) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (firstBlock?.id) {\r\n\t\t\t\t\t\tgoToBlock(firstBlock.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\t\t\t}\r\n\t\t}\r\n\t}, [isMounted]);\r\n\r\n\treturn <FormFlow applyLogic={applyLogic} />;\r\n};\r\n\r\nexport default FormWrapper;\r\n"],"mappings":"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","ignoreList":[]}