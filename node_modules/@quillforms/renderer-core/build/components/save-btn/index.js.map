{"version":3,"names":["_data","require","_element","_hooks","_reactLoaderSpinner","_button","_interopRequireDefault","_hooks2","SaveBtn","isSaving","setIsSaving","useState","saved","setSaved","formObj","isPreview","useFormContext","saved_data","snapshot","setSnapshot","answers","currentBlockId","getFieldAnswerVal","useSelect","select","getCurrentBlockId","getAnswers","isReviewing","goToBlock","setFieldValidationErr","setIsFieldValid","setIsReviewing","useDispatch","useEffect","setTimeout","saveAndContinue","saveandcontinue","recipients","enable","length","getEmailBlockId","emailBlockId","includes","replace","saveHandler","qfRender","window","ajaxurl","formId","emailValue","formData","applyFilters","formObject","data","FormData","append","JSON","stringify","_nonce","response","fetch","method","credentials","body","responseData","json","success","error","console","_react","createElement","default","disableIcon","onClick","TailSpin","wrapperClass","color","height","width","_default","exports"],"sources":["@quillforms/renderer-core/src/components/save-btn/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useState } from '@wordpress/element';\r\nimport { applyFilters } from '@wordpress/hooks';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { TailSpin as Loader } from 'react-loader-spinner';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport Button from '../button';\r\nimport { useFormContext } from '../../hooks';\r\n\r\nconst SaveBtn: React.FC = () => {\r\n\r\n\tconst [isSaving, setIsSaving] = useState(false);\r\n\tconst [saved, setSaved] = useState(false);\r\n\tconst { formObj, isPreview } = useFormContext();\r\n\t// @ts-ignore saved_data is a property of formObj.\r\n\tconst { saved_data = {} } = formObj;\r\n\tconst [snapshot, setSnapshot] = useState(saved_data?.snapshot || '');\r\n\r\n\tconst { answers, currentBlockId, getFieldAnswerVal } = useSelect(\r\n\t\t(select) => {\r\n\t\t\treturn {\r\n\t\t\t\tcurrentBlockId: select(\r\n\t\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t\t).getCurrentBlockId(),\r\n\t\t\t\tanswers: select('quillForms/renderer-core').getAnswers(),\r\n\t\t\t\tisReviewing: select('quillForms/renderer-core').isReviewing(),\r\n\t\t\t\tgetFieldAnswerVal: select('quillForms/renderer-core')\r\n\t\t\t\t\t.getFieldAnswerVal,\r\n\t\t\t};\r\n\t\t}\r\n\t);\r\n\r\n\tconst {\r\n\t\tgoToBlock,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetIsFieldValid,\r\n\t\tsetIsReviewing,\r\n\t} = useDispatch('quillForms/renderer-core');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (saved) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsetSaved(false);\r\n\t\t\t}, 2000);\r\n\t\t}\r\n\t}, [saved]);\r\n\r\n\r\n\tconst saveAndContinue = formObj?.saveandcontinue;\r\n\tconst recipients = saveAndContinue?.recipients;\r\n\r\n\tif (!saveAndContinue?.enable || !recipients?.length) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst getEmailBlockId = () => {\r\n\t\tlet emailBlockId = recipients[0];\r\n\t\t// Check if has text like {{field:blockId}} clear it and return blockId.\r\n\t\tif (!emailBlockId.includes('{{field:')) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\temailBlockId = emailBlockId.replace('{{field:', '');\r\n\t\temailBlockId = emailBlockId.replace('}}', '');\r\n\r\n\t\treturn emailBlockId;\r\n\t};\r\n\r\n\tconst saveHandler = async () => {\r\n\t\tif (isPreview || isSaving) return;\r\n\t\t// @ts-ignore, qfRender is a global variable.\r\n\t\tconst qfRender = window.qfRender;\r\n\t\tconst ajaxurl = qfRender.ajaxurl || '';\r\n\t\tconst formId = qfRender.formId;\r\n\r\n\t\tconst emailBlockId = getEmailBlockId();\r\n\t\tif (emailBlockId) {\r\n\t\t\tconst emailValue = getFieldAnswerVal(emailBlockId);\r\n\t\t\tif (!emailValue) {\r\n\t\t\t\tgoToBlock(emailBlockId);\r\n\t\t\t\tsetIsReviewing(true);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tsetIsFieldValid(emailBlockId, false);\r\n\t\t\t\t\tsetFieldValidationErr(emailBlockId, 'Error');\r\n\t\t\t\t}, 100);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetIsSaving(true);\r\n\r\n\t\ttry {\r\n\t\t\tlet formData = {\r\n\t\t\t\tanswers,\r\n\t\t\t\tcurrentBlockId,\r\n\t\t\t\tformId,\r\n\t\t\t};\r\n\r\n\t\t\tformData = applyFilters(\r\n\t\t\t\t'QuillForms.Renderer.SaveSubmissionFormData',\r\n\t\t\t\tformData,\r\n\t\t\t\t{ formObject }\r\n\t\t\t) as any;\r\n\t\t\tconst data = new FormData();\r\n\t\t\tdata.append('action', 'quillforms_form_save');\r\n\t\t\tdata.append('formData', JSON.stringify(formData));\r\n\t\t\tdata.append('quillforms_nonce', qfRender._nonce);\r\n\t\t\tif (snapshot) {\r\n\t\t\t\tdata.append('snapshot', snapshot);\r\n\t\t\t}\r\n\t\t\tconst response = await fetch(ajaxurl, {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tcredentials: 'same-origin',\r\n\t\t\t\tbody: data,\r\n\t\t\t});\r\n\t\t\tconst responseData = await response.json();\r\n\t\t\tif (responseData.success) {\r\n\t\t\t\tsetSaved(true);\r\n\t\t\t\tsetSnapshot(responseData.data.snapshot);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(error);\r\n\t\t}\r\n\r\n\t\tsetIsSaving(false);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Button disableIcon={true} onClick={saveHandler}>\r\n\t\t\t{isSaving && (\r\n\t\t\t\t<Loader\r\n\t\t\t\t\twrapperClass=\"renderer-core-submit-btn__loader\"\r\n\t\t\t\t\tcolor=\"#fff\"\r\n\t\t\t\t\theight={20}\r\n\t\t\t\t\twidth={20}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t\t{!isSaving && saved && 'Saved !'}\r\n\t\t\t{!saved && 'Save'}\r\n\t\t</Button>\r\n\t);\r\n};\r\n\r\nexport default SaveBtn;\r\n"],"mappings":"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","ignoreList":[]}