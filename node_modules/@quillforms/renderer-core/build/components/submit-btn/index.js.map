{"version":3,"names":["_data","require","_element","_classnames","_interopRequireDefault","_reactLoaderSpinner","_emotion","_button","_htmlParser","_hooks","_fieldRender","SubmitBtn","messages","useMessages","active","setActive","useState","useEffect","setTimeout","isLastField","isActive","attributes","__experimentalUseFieldRenderContext","theme","useBlockTheme","themeId","isTouchScreen","window","navigator","maxTouchPoints","msMaxTouchPoints","goToBlock","goNext","setIsReviewing","setIsSubmitting","setIsFieldValid","setFieldValidationErr","setSubmissionErr","completeForm","setIsCurrentBlockSafeToSwipe","setIsFieldPending","useDispatch","onSubmit","beforeGoingNext","useFormContext","isWaitingPending","setIsWaitingPending","answers","firstInvalidFieldId","pendingMsg","isSubmitting","submissionErr","currentBlockId","useSelect","select","getCurrentBlockId","getAnswers","getPendingMsg","getFirstInvalidFieldId","getSubmissionErr","handleKeyDown","e","key","submitHandler","goToFirstInvalidField","addEventListener","removeEventListener","setIsPending","val","reviewAndSubmit","_react","createElement","className","classNames","css","default","onClick","onKeyDown","stopPropagation","value","TailSpin","wrapperClass","color","height","width","questionsColor","_default","exports"],"sources":["@quillforms/renderer-core/src/components/submit-btn/index.tsx"],"sourcesContent":["/* eslint-disable no-nested-ternary */\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useState } from '@wordpress/element';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport classNames from 'classnames';\r\nimport { TailSpin as Loader } from 'react-loader-spinner';\r\nimport { css } from 'emotion';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport Button from '../button';\r\nimport HTMLParser from '../html-parser';\r\nimport { useBlockTheme, useFormContext, useMessages } from '../../hooks';\r\nimport { __experimentalUseFieldRenderContext } from '../field-render';\r\n\r\nconst SubmitBtn: React.FC = () => {\r\n\tconst messages = useMessages();\r\n\tconst [active, setActive] = useState(false);\r\n\r\n\tuseEffect(() => {\r\n\t\tsetTimeout(() => {\r\n\t\t\tsetActive(true);\r\n\t\t}, 100);\r\n\t});\r\n\tconst { isLastField, isActive, attributes } =\r\n\t\t__experimentalUseFieldRenderContext();\r\n\tconst theme = useBlockTheme(attributes?.themeId);\r\n\tconst isTouchScreen =\r\n\t\t(typeof window !== 'undefined' && 'ontouchstart' in window) ||\r\n\t\t(typeof navigator !== 'undefined' && navigator.maxTouchPoints > 0) ||\r\n\t\t// @ts-expect-error\r\n\t\t(typeof navigator !== 'undefined' && navigator.msMaxTouchPoints > 0);\r\n\tconst {\r\n\t\tgoToBlock,\r\n\t\tgoNext,\r\n\t\tsetIsReviewing,\r\n\t\tsetIsSubmitting,\r\n\t\tsetIsFieldValid,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetSubmissionErr,\r\n\t\tcompleteForm,\r\n\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\tsetIsFieldPending,\r\n\t} = useDispatch('quillForms/renderer-core');\r\n\tconst { onSubmit, beforeGoingNext } = useFormContext();\r\n\tconst [isWaitingPending, setIsWaitingPending] = useState(false);\r\n\r\n\tconst {\r\n\t\tanswers,\r\n\t\tfirstInvalidFieldId,\r\n\t\tpendingMsg,\r\n\t\tisSubmitting,\r\n\t\tsubmissionErr,\r\n\t\tcurrentBlockId,\r\n\t} = useSelect((select) => {\r\n\t\treturn {\r\n\t\t\tcurrentBlockId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getCurrentBlockId(),\r\n\t\t\tanswers: select('quillForms/renderer-core').getAnswers(),\r\n\t\t\tpendingMsg: select('quillForms/renderer-core').getPendingMsg(),\r\n\t\t\tisSubmitting: select('quillForms/renderer-core').isSubmitting(),\r\n\t\t\tfirstInvalidFieldId: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getFirstInvalidFieldId(),\r\n\t\t\tsubmissionErr: select(\r\n\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t).getSubmissionErr(),\r\n\t\t};\r\n\t});\r\n\r\n\r\n\tif (!currentBlockId) return null;\r\n\r\n\tconst handleKeyDown = (e) => {\r\n\t\tif (e.key === 'Enter' && !isTouchScreen) {\r\n\t\t\tsubmitHandler();\r\n\t\t}\r\n\t};\r\n\r\n\tconst goToFirstInvalidField = () => {\r\n\t\tif (firstInvalidFieldId) goToBlock(firstInvalidFieldId);\r\n\t};\r\n\tuseEffect(() => {\r\n\t\tif (isLastField && isActive) {\r\n\t\t\tsetIsReviewing(false);\r\n\t\t\twindow.addEventListener('keydown', handleKeyDown);\r\n\t\t} else {\r\n\t\t\tremoveEventListener('keydown', handleKeyDown);\r\n\t\t}\r\n\r\n\t\treturn () => removeEventListener('keydown', handleKeyDown);\r\n\t}, [isLastField, isActive]);\r\n\r\n\tconst submitHandler = async () => {\r\n\t\tif (isSubmitting) return;\r\n\t\tif (beforeGoingNext && currentBlockId) {\r\n\t\t\tawait beforeGoingNext({\r\n\t\t\t\tanswers,\r\n\t\t\t\tsetIsFieldValid,\r\n\t\t\t\tsetFieldValidationErr,\r\n\t\t\t\tgoToBlock,\r\n\t\t\t\tcurrentBlockId,\r\n\t\t\t\tgoNext,\r\n\t\t\t\tsetIsCurrentBlockSafeToSwipe,\r\n\t\t\t\tsetIsPending: (val) =>\r\n\t\t\t\t\tsetIsFieldPending(currentBlockId, val),\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (pendingMsg === false) {\r\n\t\t\treviewAndSubmit();\r\n\t\t} else {\r\n\t\t\tsetIsWaitingPending(true);\r\n\t\t}\r\n\t};\r\n\r\n\tconst reviewAndSubmit = () => {\r\n\t\tsetIsReviewing(false);\r\n\t\tif (firstInvalidFieldId) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsetIsReviewing(true);\r\n\t\t\t}, 50);\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tgoToFirstInvalidField();\r\n\t\t\t}, 100);\r\n\t\t} else {\r\n\t\t\tsetIsSubmitting(true);\r\n\t\t\tonSubmit(\r\n\t\t\t\t{ answers },\r\n\t\t\t\t{\r\n\t\t\t\t\tsetIsSubmitting,\r\n\t\t\t\t\tsetIsFieldValid,\r\n\t\t\t\t\tsetFieldValidationErr,\r\n\t\t\t\t\tsetIsReviewing,\r\n\t\t\t\t\tgoToBlock,\r\n\t\t\t\t\tcompleteForm,\r\n\t\t\t\t\tsetSubmissionErr,\r\n\t\t\t\t\tsetIsPending: (val) =>\r\n\t\t\t\t\t\tsetIsFieldPending(currentBlockId, val),\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (isWaitingPending && pendingMsg === false) {\r\n\t\t\tsetIsWaitingPending(false);\r\n\t\t\treviewAndSubmit();\r\n\t\t}\r\n\t}, [isWaitingPending, pendingMsg]);\r\n\r\n\treturn (\r\n\t\t<div className={classNames(\"renderer-core-submit-btn-wrapper\", {\r\n\t\t\tactive\r\n\t\t},\r\n\t\t\tcss`\r\n\t\t\topacity: 0;\r\n\t\t\ttransform: translateY(20px);\r\n\t\t\ttransition: all 0.4s ease;\r\n\t\t\t&.active {\r\n\t\t\t\topacity: 1;\r\n\t\t\t\ttransform: translateY(0);\r\n\t\t\t}\r\n\t\t`)}>\r\n\t\t\t<Button\r\n\t\t\t\tclassName=\"renderer-core-submit-btn\"\r\n\t\t\t\tonClick={() => {\r\n\t\t\t\t\tif (!isSubmitting) submitHandler();\r\n\t\t\t\t}}\r\n\t\t\t\tonKeyDown={(e) => {\r\n\t\t\t\t\tif (e.key === 'Enter') {\r\n\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\tif (!isSubmitting) submitHandler();\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t\ttheme={theme}\r\n\t\t\t>\r\n\t\t\t\t<HTMLParser\r\n\t\t\t\t\tvalue={\r\n\t\t\t\t\t\tisWaitingPending\r\n\t\t\t\t\t\t\t? pendingMsg\r\n\t\t\t\t\t\t\t\t? pendingMsg\r\n\t\t\t\t\t\t\t\t: ''\r\n\t\t\t\t\t\t\t: messages['label.submitBtn']\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t\t{(isWaitingPending || isSubmitting) && (\r\n\t\t\t\t\t<Loader\r\n\t\t\t\t\t\twrapperClass=\"renderer-core-submit-btn__loader\"\r\n\t\t\t\t\t\tcolor=\"#fff\"\r\n\t\t\t\t\t\theight={20}\r\n\t\t\t\t\t\twidth={20}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</Button>\r\n\t\t\t{submissionErr && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName={classNames(\r\n\t\t\t\t\t\t'renderer-core-submit-error',\r\n\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\tcolor: ${theme.questionsColor};\r\n\t\t\t\t\t\t\tmargin-top: 15px;\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t)}\r\n\t\t\t\t>\r\n\t\t\t\t\t{submissionErr}\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\nexport default SubmitBtn;\r\n"],"mappings":";;;;;;;;AAIA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAKA,IAAAE,WAAA,GAAAC,sBAAA,CAAAH,OAAA;AACA,IAAAI,mBAAA,GAAAJ,OAAA;AACA,IAAAK,QAAA,GAAAL,OAAA;AAKA,IAAAM,OAAA,GAAAH,sBAAA,CAAAH,OAAA;AACA,IAAAO,WAAA,GAAAJ,sBAAA,CAAAH,OAAA;AACA,IAAAQ,MAAA,GAAAR,OAAA;AACA,IAAAS,YAAA,GAAAT,OAAA;AApBA;AACA;AACA;AACA;;AAIA;AACA;AACA;;AAKA;AACA;AACA;;AAMA,MAAMU,SAAmB,GAAGA,CAAA,KAAM;EACjC,MAAMC,QAAQ,GAAG,IAAAC,kBAAW,EAAC,CAAC;EAC9B,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAG,IAAAC,iBAAQ,EAAC,KAAK,CAAC;EAE3C,IAAAC,kBAAS,EAAC,MAAM;IACfC,UAAU,CAAC,MAAM;MAChBH,SAAS,CAAC,IAAI,CAAC;IAChB,CAAC,EAAE,GAAG,CAAC;EACR,CAAC,CAAC;EACF,MAAM;IAAEI,WAAW;IAAEC,QAAQ;IAAEC;EAAW,CAAC,GAC1C,IAAAC,gDAAmC,EAAC,CAAC;EACtC,MAAMC,KAAK,GAAG,IAAAC,oBAAa,EAACH,UAAU,EAAEI,OAAO,CAAC;EAChD,MAAMC,aAAa,GACjB,OAAOC,MAAM,KAAK,WAAW,IAAI,cAAc,IAAIA,MAAM,IACzD,OAAOC,SAAS,KAAK,WAAW,IAAIA,SAAS,CAACC,cAAc,GAAG,CAAE;EAClE;EACC,OAAOD,SAAS,KAAK,WAAW,IAAIA,SAAS,CAACE,gBAAgB,GAAG,CAAE;EACrE,MAAM;IACLC,SAAS;IACTC,MAAM;IACNC,cAAc;IACdC,eAAe;IACfC,eAAe;IACfC,qBAAqB;IACrBC,gBAAgB;IAChBC,YAAY;IACZC,4BAA4B;IAC5BC;EACD,CAAC,GAAG,IAAAC,iBAAW,EAAC,0BAA0B,CAAC;EAC3C,MAAM;IAAEC,QAAQ;IAAEC;EAAgB,CAAC,GAAG,IAAAC,qBAAc,EAAC,CAAC;EACtD,MAAM,CAACC,gBAAgB,EAAEC,mBAAmB,CAAC,GAAG,IAAA9B,iBAAQ,EAAC,KAAK,CAAC;EAE/D,MAAM;IACL+B,OAAO;IACPC,mBAAmB;IACnBC,UAAU;IACVC,YAAY;IACZC,aAAa;IACbC;EACD,CAAC,GAAG,IAAAC,eAAS,EAAEC,MAAM,IAAK;IACzB,OAAO;MACNF,cAAc,EAAEE,MAAM,CACrB,0BACD,CAAC,CAACC,iBAAiB,CAAC,CAAC;MACrBR,OAAO,EAAEO,MAAM,CAAC,0BAA0B,CAAC,CAACE,UAAU,CAAC,CAAC;MACxDP,UAAU,EAAEK,MAAM,CAAC,0BAA0B,CAAC,CAACG,aAAa,CAAC,CAAC;MAC9DP,YAAY,EAAEI,MAAM,CAAC,0BAA0B,CAAC,CAACJ,YAAY,CAAC,CAAC;MAC/DF,mBAAmB,EAAEM,MAAM,CAC1B,0BACD,CAAC,CAACI,sBAAsB,CAAC,CAAC;MAC1BP,aAAa,EAAEG,MAAM,CACpB,0BACD,CAAC,CAACK,gBAAgB,CAAC;IACpB,CAAC;EACF,CAAC,CAAC;EAGF,IAAI,CAACP,cAAc,EAAE,OAAO,IAAI;EAEhC,MAAMQ,aAAa,GAAIC,CAAC,IAAK;IAC5B,IAAIA,CAAC,CAACC,GAAG,KAAK,OAAO,IAAI,CAACpC,aAAa,EAAE;MACxCqC,aAAa,CAAC,CAAC;IAChB;EACD,CAAC;EAED,MAAMC,qBAAqB,GAAGA,CAAA,KAAM;IACnC,IAAIhB,mBAAmB,EAAEjB,SAAS,CAACiB,mBAAmB,CAAC;EACxD,CAAC;EACD,IAAA/B,kBAAS,EAAC,MAAM;IACf,IAAIE,WAAW,IAAIC,QAAQ,EAAE;MAC5Ba,cAAc,CAAC,KAAK,CAAC;MACrBN,MAAM,CAACsC,gBAAgB,CAAC,SAAS,EAAEL,aAAa,CAAC;IAClD,CAAC,MAAM;MACNM,mBAAmB,CAAC,SAAS,EAAEN,aAAa,CAAC;IAC9C;IAEA,OAAO,MAAMM,mBAAmB,CAAC,SAAS,EAAEN,aAAa,CAAC;EAC3D,CAAC,EAAE,CAACzC,WAAW,EAAEC,QAAQ,CAAC,CAAC;EAE3B,MAAM2C,aAAa,GAAG,MAAAA,CAAA,KAAY;IACjC,IAAIb,YAAY,EAAE;IAClB,IAAIP,eAAe,IAAIS,cAAc,EAAE;MACtC,MAAMT,eAAe,CAAC;QACrBI,OAAO;QACPZ,eAAe;QACfC,qBAAqB;QACrBL,SAAS;QACTqB,cAAc;QACdpB,MAAM;QACNO,4BAA4B;QAC5B4B,YAAY,EAAGC,GAAG,IACjB5B,iBAAiB,CAACY,cAAc,EAAEgB,GAAG;MACvC,CAAC,CAAC;IACH;IACA,IAAInB,UAAU,KAAK,KAAK,EAAE;MACzBoB,eAAe,CAAC,CAAC;IAClB,CAAC,MAAM;MACNvB,mBAAmB,CAAC,IAAI,CAAC;IAC1B;EACD,CAAC;EAED,MAAMuB,eAAe,GAAGA,CAAA,KAAM;IAC7BpC,cAAc,CAAC,KAAK,CAAC;IACrB,IAAIe,mBAAmB,EAAE;MACxB9B,UAAU,CAAC,MAAM;QAChBe,cAAc,CAAC,IAAI,CAAC;MACrB,CAAC,EAAE,EAAE,CAAC;MAENf,UAAU,CAAC,MAAM;QAChB8C,qBAAqB,CAAC,CAAC;MACxB,CAAC,EAAE,GAAG,CAAC;IACR,CAAC,MAAM;MACN9B,eAAe,CAAC,IAAI,CAAC;MACrBQ,QAAQ,CACP;QAAEK;MAAQ,CAAC,EACX;QACCb,eAAe;QACfC,eAAe;QACfC,qBAAqB;QACrBH,cAAc;QACdF,SAAS;QACTO,YAAY;QACZD,gBAAgB;QAChB8B,YAAY,EAAGC,GAAG,IACjB5B,iBAAiB,CAACY,cAAc,EAAEgB,GAAG;MACvC,CACD,CAAC;IACF;EACD,CAAC;EAED,IAAAnD,kBAAS,EAAC,MAAM;IACf,IAAI4B,gBAAgB,IAAII,UAAU,KAAK,KAAK,EAAE;MAC7CH,mBAAmB,CAAC,KAAK,CAAC;MAC1BuB,eAAe,CAAC,CAAC;IAClB;EACD,CAAC,EAAE,CAACxB,gBAAgB,EAAEI,UAAU,CAAC,CAAC;EAElC,OACC,IAAAqB,MAAA,CAAAC,aAAA;IAAKC,SAAS,EAAE,IAAAC,mBAAU,EAAC,kCAAkC,EAAE;MAC9D3D;IACD,CAAC,EACA,IAAA4D,YAAG,CAAC;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;EAAE,GACF,IAAAJ,MAAA,CAAAC,aAAA,EAAChE,OAAA,CAAAoE,OAAM;IACNH,SAAS,EAAC,0BAA0B;IACpCI,OAAO,EAAEA,CAAA,KAAM;MACd,IAAI,CAAC1B,YAAY,EAAEa,aAAa,CAAC,CAAC;IACnC,CAAE;IACFc,SAAS,EAAGhB,CAAC,IAAK;MACjB,IAAIA,CAAC,CAACC,GAAG,KAAK,OAAO,EAAE;QACtBD,CAAC,CAACiB,eAAe,CAAC,CAAC;QACnB,IAAI,CAAC5B,YAAY,EAAEa,aAAa,CAAC,CAAC;MACnC;IACD,CAAE;IACFxC,KAAK,EAAEA;EAAM,GAEb,IAAA+C,MAAA,CAAAC,aAAA,EAAC/D,WAAA,CAAAmE,OAAU;IACVI,KAAK,EACJlC,gBAAgB,GACbI,UAAU,GACTA,UAAU,GACV,EAAE,GACHrC,QAAQ,CAAC,iBAAiB;EAC7B,CACD,CAAC,EACD,CAACiC,gBAAgB,IAAIK,YAAY,KACjC,IAAAoB,MAAA,CAAAC,aAAA,EAAClE,mBAAA,CAAA2E,QAAM;IACNC,YAAY,EAAC,kCAAkC;IAC/CC,KAAK,EAAC,MAAM;IACZC,MAAM,EAAE,EAAG;IACXC,KAAK,EAAE;EAAG,CACV,CAEK,CAAC,EACRjC,aAAa,IACb,IAAAmB,MAAA,CAAAC,aAAA;IACCC,SAAS,EAAE,IAAAC,mBAAU,EACpB,4BAA4B,EAC5B,IAAAC,YAAG,CAAC;AACV,gBAAgBnD,KAAK,CAAC8D,cAAe;AACrC;AACA,OACK;EAAE,GAEDlC,aACG,CAEF,CAAC;AAER,CAAC;AAAC,IAAAmC,QAAA,GAAAC,OAAA,CAAAZ,OAAA,GACahE,SAAS","ignoreList":[]}