"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _react = require("react");
var _data = require("@wordpress/data");
var _classnames = _interopRequireDefault(require("classnames"));
var _emotion = require("emotion");
var _hooks = require("../../hooks");
var _downIcon = _interopRequireDefault(require("./down-icon"));
var _upIcon = _interopRequireDefault(require("./up-icon"));
var _useCorrectIncorrectQuiz = _interopRequireDefault(require("../../hooks/use-correct-incorrect-quiz"));
/**
 * WordPress Dependencies
 */

/**
 * External Dependencies
 */

/**
 * Internal Dependencies
 */

const FieldNavigation = ({
  shouldFooterBeDisplayed
}) => {
  const {
    goNext,
    goPrev,
    setIsCurrentBlockSafeToSwipe,
    setIsFieldValid,
    setIsFieldPending,
    setFieldValidationErr,
    goToBlock,
    setCorrectIncorrectDisplay,
    setIsFieldCorrectIncorrectScreenDisplayed
  } = (0, _data.useDispatch)('quillForms/renderer-core');
  const {
    beforeGoingNext
  } = (0, _hooks.useFormContext)();
  const theme = (0, _hooks.useCurrentTheme)();
  const settings = (0, _hooks.useFormSettings)();
  const correctIncorrectQuiz = (0, _useCorrectIncorrectQuiz.default)();
  const {
    currentBlockId,
    walkPath,
    blockTypes,
    correctIncorrectDisplay
  } = (0, _data.useSelect)(select => {
    return {
      currentBlockId: select('quillForms/renderer-core').getCurrentBlockId(),
      walkPath: select('quillForms/renderer-core').getWalkPath(),
      blockTypes: select('quillForms/blocks').getBlockTypes(),
      correctIncorrectDisplay: select('quillForms/renderer-core').getCorrectIncorrectDisplay()
    };
  });
  if (!currentBlockId) return null;
  const currentBlockIndex = walkPath.findIndex(block => block.id === currentBlockId);
  const currentBlockName = walkPath[currentBlockIndex]?.name;
  const currentBlockType = blockTypes?.[currentBlockName];
  const {
    isCurrentBlockValid,
    answers,
    isFieldCorrectIncorrectScreenDisplayed
  } = (0, _data.useSelect)(select => {
    return {
      answers: select('quillForms/renderer-core').getAnswers(),
      isCurrentBlockValid: currentBlockType?.supports?.innerBlocks ? select('quillForms/renderer-core')?.hasValidFields(currentBlockId) : currentBlockType?.supports?.editable ? select('quillForms/renderer-core')?.isValidField(currentBlockId) : true,
      isFieldCorrectIncorrectScreenDisplayed: select('quillForms/renderer-core').isFieldCorrectIncorrectScreenDisplayed(currentBlockId)
    };
  });
  const goNextReally = async () => {
    if (answers[currentBlockIndex]?.isPending) return;
    if (beforeGoingNext && currentBlockId) {
      await beforeGoingNext({
        answers,
        currentBlockId,
        setIsFieldValid,
        setFieldValidationErr,
        setIsCurrentBlockSafeToSwipe,
        goToBlock,
        goNext,
        setIsPending: val => setIsFieldPending(currentBlockId, val)
      });
    } else {
      if (correctIncorrectQuiz?.enabled && correctIncorrectDisplay === false && currentBlockType.supports.correctAnswers && !isFieldCorrectIncorrectScreenDisplayed) {
        setCorrectIncorrectDisplay(true);
        setIsFieldCorrectIncorrectScreenDisplayed(currentBlockId, true);
        return;
      }
      goNext();
    }
  };
  return (0, _react.createElement)("div", {
    className: (0, _classnames.default)('renderer-core-field-navigation', {
      hidden: !shouldFooterBeDisplayed
    })
  }, (0, _react.createElement)("div", {
    className: (0, _classnames.default)('renderer-core-field-navigation__up-icon', {
      rotate: settings?.animationDirection === 'horizontal'
    }, (0, _emotion.css)`
						background: ${theme.buttonsBgColor};
					`),
    onClick: () => {
      goPrev();
    }
  }, (0, _react.createElement)(_upIcon.default, null)), (0, _react.createElement)("div", {
    className: (0, _classnames.default)('renderer-core-field-navigation__down-icon', {
      rotate: settings?.animationDirection === 'horizontal'
    }, (0, _emotion.css)`
						background: ${theme.buttonsBgColor};
					`),
    onClick: () => {
      if (walkPath[walkPath.length - 1].id !== currentBlockId) {
        if (isCurrentBlockValid) {
          goNextReally();
        } else {
          setIsCurrentBlockSafeToSwipe(false);
        }
      }
    }
  }, (0, _react.createElement)(_downIcon.default, null)));
};
var _default = exports.default = FieldNavigation;
//# sourceMappingURL=index.js.map