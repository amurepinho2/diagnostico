{"ast":null,"code":"import { createElement } from \"react\";\n/**\r\n * WordPress Dependencies\r\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useEffect, useState } from '@wordpress/element';\nimport { applyFilters } from '@wordpress/hooks';\n\n/**\r\n * External Dependencies\r\n */\nimport { TailSpin as Loader } from 'react-loader-spinner';\n\n/**\r\n * Internal Dependencies\r\n */\nimport Button from '../button';\nimport { useFormContext } from '../../hooks';\nconst SaveBtn = () => {\n  const [isSaving, setIsSaving] = useState(false);\n  const [saved, setSaved] = useState(false);\n  const {\n    formObj,\n    isPreview\n  } = useFormContext();\n  // @ts-ignore saved_data is a property of formObj.\n  const {\n    saved_data = {}\n  } = formObj;\n  const [snapshot, setSnapshot] = useState(saved_data?.snapshot || '');\n  const {\n    answers,\n    currentBlockId,\n    getFieldAnswerVal\n  } = useSelect(select => {\n    return {\n      currentBlockId: select('quillForms/renderer-core').getCurrentBlockId(),\n      answers: select('quillForms/renderer-core').getAnswers(),\n      isReviewing: select('quillForms/renderer-core').isReviewing(),\n      getFieldAnswerVal: select('quillForms/renderer-core').getFieldAnswerVal\n    };\n  });\n  const {\n    goToBlock,\n    setFieldValidationErr,\n    setIsFieldValid,\n    setIsReviewing\n  } = useDispatch('quillForms/renderer-core');\n  useEffect(() => {\n    if (saved) {\n      setTimeout(() => {\n        setSaved(false);\n      }, 2000);\n    }\n  }, [saved]);\n  const saveAndContinue = formObj?.saveandcontinue;\n  const recipients = saveAndContinue?.recipients;\n  if (!saveAndContinue?.enable || !recipients?.length) {\n    return null;\n  }\n  const getEmailBlockId = () => {\n    let emailBlockId = recipients[0];\n    // Check if has text like {{field:blockId}} clear it and return blockId.\n    if (!emailBlockId.includes('{{field:')) {\n      return false;\n    }\n    emailBlockId = emailBlockId.replace('{{field:', '');\n    emailBlockId = emailBlockId.replace('}}', '');\n    return emailBlockId;\n  };\n  const saveHandler = async () => {\n    if (isPreview || isSaving) return;\n    // @ts-ignore, qfRender is a global variable.\n    const qfRender = window.qfRender;\n    const ajaxurl = qfRender.ajaxurl || '';\n    const formId = qfRender.formId;\n    const emailBlockId = getEmailBlockId();\n    if (emailBlockId) {\n      const emailValue = getFieldAnswerVal(emailBlockId);\n      if (!emailValue) {\n        goToBlock(emailBlockId);\n        setIsReviewing(true);\n        setTimeout(() => {\n          setIsFieldValid(emailBlockId, false);\n          setFieldValidationErr(emailBlockId, 'Error');\n        }, 100);\n        return;\n      }\n    }\n    setIsSaving(true);\n    try {\n      let formData = {\n        answers,\n        currentBlockId,\n        formId\n      };\n      formData = applyFilters('QuillForms.Renderer.SaveSubmissionFormData', formData, {\n        formObject\n      });\n      const data = new FormData();\n      data.append('action', 'quillforms_form_save');\n      data.append('formData', JSON.stringify(formData));\n      data.append('quillforms_nonce', qfRender._nonce);\n      if (snapshot) {\n        data.append('snapshot', snapshot);\n      }\n      const response = await fetch(ajaxurl, {\n        method: 'POST',\n        credentials: 'same-origin',\n        body: data\n      });\n      const responseData = await response.json();\n      if (responseData.success) {\n        setSaved(true);\n        setSnapshot(responseData.data.snapshot);\n      }\n    } catch (error) {\n      console.error(error);\n    }\n    setIsSaving(false);\n  };\n  return createElement(Button, {\n    disableIcon: true,\n    onClick: saveHandler\n  }, isSaving && createElement(Loader, {\n    wrapperClass: \"renderer-core-submit-btn__loader\",\n    color: \"#fff\",\n    height: 20,\n    width: 20\n  }), !isSaving && saved && 'Saved !', !saved && 'Save');\n};\nexport default SaveBtn;","map":{"version":3,"names":["useSelect","useDispatch","useEffect","useState","applyFilters","TailSpin","Loader","Button","useFormContext","SaveBtn","isSaving","setIsSaving","saved","setSaved","formObj","isPreview","saved_data","snapshot","setSnapshot","answers","currentBlockId","getFieldAnswerVal","select","getCurrentBlockId","getAnswers","isReviewing","goToBlock","setFieldValidationErr","setIsFieldValid","setIsReviewing","setTimeout","saveAndContinue","saveandcontinue","recipients","enable","length","getEmailBlockId","emailBlockId","includes","replace","saveHandler","qfRender","window","ajaxurl","formId","emailValue","formData","formObject","data","FormData","append","JSON","stringify","_nonce","response","fetch","method","credentials","body","responseData","json","success","error","console","createElement","disableIcon","onClick","wrapperClass","color","height","width"],"sources":["/Users/amurepinho/Documents/GitHub/diagnostico/node_modules/@quillforms/renderer-core/build-module/components/save-btn/@quillforms/renderer-core/src/components/save-btn/index.tsx"],"sourcesContent":["/**\r\n * WordPress Dependencies\r\n */\r\nimport { useSelect, useDispatch } from '@wordpress/data';\r\nimport { useEffect, useState } from '@wordpress/element';\r\nimport { applyFilters } from '@wordpress/hooks';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { TailSpin as Loader } from 'react-loader-spinner';\r\n\r\n/**\r\n * Internal Dependencies\r\n */\r\nimport Button from '../button';\r\nimport { useFormContext } from '../../hooks';\r\n\r\nconst SaveBtn: React.FC = () => {\r\n\r\n\tconst [isSaving, setIsSaving] = useState(false);\r\n\tconst [saved, setSaved] = useState(false);\r\n\tconst { formObj, isPreview } = useFormContext();\r\n\t// @ts-ignore saved_data is a property of formObj.\r\n\tconst { saved_data = {} } = formObj;\r\n\tconst [snapshot, setSnapshot] = useState(saved_data?.snapshot || '');\r\n\r\n\tconst { answers, currentBlockId, getFieldAnswerVal } = useSelect(\r\n\t\t(select) => {\r\n\t\t\treturn {\r\n\t\t\t\tcurrentBlockId: select(\r\n\t\t\t\t\t'quillForms/renderer-core'\r\n\t\t\t\t).getCurrentBlockId(),\r\n\t\t\t\tanswers: select('quillForms/renderer-core').getAnswers(),\r\n\t\t\t\tisReviewing: select('quillForms/renderer-core').isReviewing(),\r\n\t\t\t\tgetFieldAnswerVal: select('quillForms/renderer-core')\r\n\t\t\t\t\t.getFieldAnswerVal,\r\n\t\t\t};\r\n\t\t}\r\n\t);\r\n\r\n\tconst {\r\n\t\tgoToBlock,\r\n\t\tsetFieldValidationErr,\r\n\t\tsetIsFieldValid,\r\n\t\tsetIsReviewing,\r\n\t} = useDispatch('quillForms/renderer-core');\r\n\r\n\tuseEffect(() => {\r\n\t\tif (saved) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsetSaved(false);\r\n\t\t\t}, 2000);\r\n\t\t}\r\n\t}, [saved]);\r\n\r\n\r\n\tconst saveAndContinue = formObj?.saveandcontinue;\r\n\tconst recipients = saveAndContinue?.recipients;\r\n\r\n\tif (!saveAndContinue?.enable || !recipients?.length) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst getEmailBlockId = () => {\r\n\t\tlet emailBlockId = recipients[0];\r\n\t\t// Check if has text like {{field:blockId}} clear it and return blockId.\r\n\t\tif (!emailBlockId.includes('{{field:')) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\temailBlockId = emailBlockId.replace('{{field:', '');\r\n\t\temailBlockId = emailBlockId.replace('}}', '');\r\n\r\n\t\treturn emailBlockId;\r\n\t};\r\n\r\n\tconst saveHandler = async () => {\r\n\t\tif (isPreview || isSaving) return;\r\n\t\t// @ts-ignore, qfRender is a global variable.\r\n\t\tconst qfRender = window.qfRender;\r\n\t\tconst ajaxurl = qfRender.ajaxurl || '';\r\n\t\tconst formId = qfRender.formId;\r\n\r\n\t\tconst emailBlockId = getEmailBlockId();\r\n\t\tif (emailBlockId) {\r\n\t\t\tconst emailValue = getFieldAnswerVal(emailBlockId);\r\n\t\t\tif (!emailValue) {\r\n\t\t\t\tgoToBlock(emailBlockId);\r\n\t\t\t\tsetIsReviewing(true);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tsetIsFieldValid(emailBlockId, false);\r\n\t\t\t\t\tsetFieldValidationErr(emailBlockId, 'Error');\r\n\t\t\t\t}, 100);\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsetIsSaving(true);\r\n\r\n\t\ttry {\r\n\t\t\tlet formData = {\r\n\t\t\t\tanswers,\r\n\t\t\t\tcurrentBlockId,\r\n\t\t\t\tformId,\r\n\t\t\t};\r\n\r\n\t\t\tformData = applyFilters(\r\n\t\t\t\t'QuillForms.Renderer.SaveSubmissionFormData',\r\n\t\t\t\tformData,\r\n\t\t\t\t{ formObject }\r\n\t\t\t) as any;\r\n\t\t\tconst data = new FormData();\r\n\t\t\tdata.append('action', 'quillforms_form_save');\r\n\t\t\tdata.append('formData', JSON.stringify(formData));\r\n\t\t\tdata.append('quillforms_nonce', qfRender._nonce);\r\n\t\t\tif (snapshot) {\r\n\t\t\t\tdata.append('snapshot', snapshot);\r\n\t\t\t}\r\n\t\t\tconst response = await fetch(ajaxurl, {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\tcredentials: 'same-origin',\r\n\t\t\t\tbody: data,\r\n\t\t\t});\r\n\t\t\tconst responseData = await response.json();\r\n\t\t\tif (responseData.success) {\r\n\t\t\t\tsetSaved(true);\r\n\t\t\t\tsetSnapshot(responseData.data.snapshot);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(error);\r\n\t\t}\r\n\r\n\t\tsetIsSaving(false);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<Button disableIcon={true} onClick={saveHandler}>\r\n\t\t\t{isSaving && (\r\n\t\t\t\t<Loader\r\n\t\t\t\t\twrapperClass=\"renderer-core-submit-btn__loader\"\r\n\t\t\t\t\tcolor=\"#fff\"\r\n\t\t\t\t\theight={20}\r\n\t\t\t\t\twidth={20}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t\t{!isSaving && saved && 'Saved !'}\r\n\t\t\t{!saved && 'Save'}\r\n\t\t</Button>\r\n\t);\r\n};\r\n\r\nexport default SaveBtn;\r\n"],"mappings":";AAAA;AACA;AACA;AACA,SAASA,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACxD,SAASC,SAAS,EAAEC,QAAQ,QAAQ,oBAAoB;AACxD,SAASC,YAAY,QAAQ,kBAAkB;;AAE/C;AACA;AACA;AACA,SAASC,QAAQ,IAAIC,MAAM,QAAQ,sBAAsB;;AAEzD;AACA;AACA;AACA,OAAOC,MAAM,MAAM,WAAW;AAC9B,SAASC,cAAc,QAAQ,aAAa;AAE5C,MAAMC,OAAiB,GAAGA,CAAA,KAAM;EAE/B,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGR,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM,CAACS,KAAK,EAAEC,QAAQ,CAAC,GAAGV,QAAQ,CAAC,KAAK,CAAC;EACzC,MAAM;IAAEW,OAAO;IAAEC;EAAU,CAAC,GAAGP,cAAc,CAAC,CAAC;EAC/C;EACA,MAAM;IAAEQ,UAAU,GAAG,CAAC;EAAE,CAAC,GAAGF,OAAO;EACnC,MAAM,CAACG,QAAQ,EAAEC,WAAW,CAAC,GAAGf,QAAQ,CAACa,UAAU,EAAEC,QAAQ,IAAI,EAAE,CAAC;EAEpE,MAAM;IAAEE,OAAO;IAAEC,cAAc;IAAEC;EAAkB,CAAC,GAAGrB,SAAS,CAC9DsB,MAAM,IAAK;IACX,OAAO;MACNF,cAAc,EAAEE,MAAM,CACrB,0BACD,CAAC,CAACC,iBAAiB,CAAC,CAAC;MACrBJ,OAAO,EAAEG,MAAM,CAAC,0BAA0B,CAAC,CAACE,UAAU,CAAC,CAAC;MACxDC,WAAW,EAAEH,MAAM,CAAC,0BAA0B,CAAC,CAACG,WAAW,CAAC,CAAC;MAC7DJ,iBAAiB,EAAEC,MAAM,CAAC,0BAA0B,CAAC,CACnDD;IACH,CAAC;EACF,CACD,CAAC;EAED,MAAM;IACLK,SAAS;IACTC,qBAAqB;IACrBC,eAAe;IACfC;EACD,CAAC,GAAG5B,WAAW,CAAC,0BAA0B,CAAC;EAE3CC,SAAS,CAAC,MAAM;IACf,IAAIU,KAAK,EAAE;MACVkB,UAAU,CAAC,MAAM;QAChBjB,QAAQ,CAAC,KAAK,CAAC;MAChB,CAAC,EAAE,IAAI,CAAC;IACT;EACD,CAAC,EAAE,CAACD,KAAK,CAAC,CAAC;EAGX,MAAMmB,eAAe,GAAGjB,OAAO,EAAEkB,eAAe;EAChD,MAAMC,UAAU,GAAGF,eAAe,EAAEE,UAAU;EAE9C,IAAI,CAACF,eAAe,EAAEG,MAAM,IAAI,CAACD,UAAU,EAAEE,MAAM,EAAE;IACpD,OAAO,IAAI;EACZ;EAEA,MAAMC,eAAe,GAAGA,CAAA,KAAM;IAC7B,IAAIC,YAAY,GAAGJ,UAAU,CAAC,CAAC,CAAC;IAChC;IACA,IAAI,CAACI,YAAY,CAACC,QAAQ,CAAC,UAAU,CAAC,EAAE;MACvC,OAAO,KAAK;IACb;IACAD,YAAY,GAAGA,YAAY,CAACE,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC;IACnDF,YAAY,GAAGA,YAAY,CAACE,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;IAE7C,OAAOF,YAAY;EACpB,CAAC;EAED,MAAMG,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC/B,IAAIzB,SAAS,IAAIL,QAAQ,EAAE;IAC3B;IACA,MAAM+B,QAAQ,GAAGC,MAAM,CAACD,QAAQ;IAChC,MAAME,OAAO,GAAGF,QAAQ,CAACE,OAAO,IAAI,EAAE;IACtC,MAAMC,MAAM,GAAGH,QAAQ,CAACG,MAAM;IAE9B,MAAMP,YAAY,GAAGD,eAAe,CAAC,CAAC;IACtC,IAAIC,YAAY,EAAE;MACjB,MAAMQ,UAAU,GAAGxB,iBAAiB,CAACgB,YAAY,CAAC;MAClD,IAAI,CAACQ,UAAU,EAAE;QAChBnB,SAAS,CAACW,YAAY,CAAC;QACvBR,cAAc,CAAC,IAAI,CAAC;QACpBC,UAAU,CAAC,MAAM;UAChBF,eAAe,CAACS,YAAY,EAAE,KAAK,CAAC;UACpCV,qBAAqB,CAACU,YAAY,EAAE,OAAO,CAAC;QAC7C,CAAC,EAAE,GAAG,CAAC;QAEP;MACD;IACD;IACA1B,WAAW,CAAC,IAAI,CAAC;IAEjB,IAAI;MACH,IAAImC,QAAQ,GAAG;QACd3B,OAAO;QACPC,cAAc;QACdwB;MACD,CAAC;MAEDE,QAAQ,GAAG1C,YAAY,CACtB,4CAA4C,EAC5C0C,QAAQ,EACR;QAAEC;MAAW,CACd,CAAQ;MACR,MAAMC,IAAI,GAAG,IAAIC,QAAQ,CAAC,CAAC;MAC3BD,IAAI,CAACE,MAAM,CAAC,QAAQ,EAAE,sBAAsB,CAAC;MAC7CF,IAAI,CAACE,MAAM,CAAC,UAAU,EAAEC,IAAI,CAACC,SAAS,CAACN,QAAQ,CAAC,CAAC;MACjDE,IAAI,CAACE,MAAM,CAAC,kBAAkB,EAAET,QAAQ,CAACY,MAAM,CAAC;MAChD,IAAIpC,QAAQ,EAAE;QACb+B,IAAI,CAACE,MAAM,CAAC,UAAU,EAAEjC,QAAQ,CAAC;MAClC;MACA,MAAMqC,QAAQ,GAAG,MAAMC,KAAK,CAACZ,OAAO,EAAE;QACrCa,MAAM,EAAE,MAAM;QACdC,WAAW,EAAE,aAAa;QAC1BC,IAAI,EAAEV;MACP,CAAC,CAAC;MACF,MAAMW,YAAY,GAAG,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;MAC1C,IAAID,YAAY,CAACE,OAAO,EAAE;QACzBhD,QAAQ,CAAC,IAAI,CAAC;QACdK,WAAW,CAACyC,YAAY,CAACX,IAAI,CAAC/B,QAAQ,CAAC;MACxC;IACD,CAAC,CAAC,OAAO6C,KAAK,EAAE;MACfC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACrB;IAEAnD,WAAW,CAAC,KAAK,CAAC;EACnB,CAAC;EAED,OACCqD,aAAA,CAACzD,MAAM;IAAC0D,WAAW,EAAE,IAAK;IAACC,OAAO,EAAE1B;EAAY,GAC9C9B,QAAQ,IACRsD,aAAA,CAAC1D,MAAM;IACN6D,YAAY,EAAC,kCAAkC;IAC/CC,KAAK,EAAC,MAAM;IACZC,MAAM,EAAE,EAAG;IACXC,KAAK,EAAE;EAAG,CACV,CACD,EACA,CAAC5D,QAAQ,IAAIE,KAAK,IAAI,SAAS,EAC/B,CAACA,KAAK,IAAI,MACJ,CAAC;AAEX,CAAC;AAED,eAAeH,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}