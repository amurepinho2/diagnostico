{"ast":null,"code":"import { createElement, Fragment } from \"react\";\n/**\r\n * QuillForms Dependencies\r\n */\nimport { getPaymentGatewayModules } from '@quillforms/payment-gateways';\nimport Button from '../../button';\nimport configApi from '@quillforms/config';\n\n/**\r\n * WordPress Dependencies\r\n */\nimport RadioControl from './radio-control';\nimport { useState } from '@wordpress/element';\nimport { useDispatch } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\nimport useGeneralTheme from '../../../hooks/use-general-theme';\n\n/**\r\n * External Dependencies\r\n */\nimport { css } from 'emotion';\nimport { size } from 'lodash';\nimport classnames from 'classnames';\nimport { TailSpin as Loader } from 'react-loader-spinner';\nconst Methods = ({\n  data\n}) => {\n  var _urlParams$get, _data$payments$labels, _data$payments$labels2;\n  const {\n    setPaymentData,\n    completeForm\n  } = useDispatch('quillForms/renderer-core');\n  const generalTheme = useGeneralTheme();\n  const gateways = getPaymentGatewayModules();\n  const methodsKeys = Object.keys(data.payments.methods);\n  const options = methodsKeys.map(key => {\n    const [gateway, method] = key.split(':');\n    return {\n      label: gateways[gateway].methods[method].customer.label.text,\n      value: key\n    };\n  });\n  const urlParams = new URLSearchParams(window.location.search);\n  let defaultMethod = methodsKeys[0];\n  if (urlParams.get('step') === 'payment' && methodsKeys.includes((_urlParams$get = urlParams.get('method')) !== null && _urlParams$get !== void 0 ? _urlParams$get : '')) {\n    var _urlParams$get2;\n    defaultMethod = (_urlParams$get2 = urlParams.get('method')) !== null && _urlParams$get2 !== void 0 ? _urlParams$get2 : '';\n  }\n  const [selected, setSelected] = useState(defaultMethod);\n  const [gateway, method] = selected.split(':');\n  const CustomerRender = gateways[gateway].methods[method].customer.render;\n  const discountDetails = data.payments?.discount_details;\n  const discountAmount = discountDetails?.amount;\n  const [isPaying, setIsPaying] = useState(false);\n  const completeFullDiscountedOrders = async () => {\n    if (isPaying) return;\n    setIsPaying(true);\n    try {\n      const {\n        submission_id,\n        hashed_id\n      } = data;\n      let response = await fetch(configApi.getAdminUrl() + 'admin-ajax.php', {\n        method: 'POST',\n        body: new URLSearchParams({\n          action: 'quillforms_complete_full_discounted_orders',\n          submissionId: submission_id,\n          hashedId: hashed_id\n        })\n      });\n      let result = await response.json();\n      if (result.success) {\n        completeForm();\n      } else {\n        throw new Error(result.message);\n      }\n    } catch (e) {\n      console.log('completePendingSubmission: error throwed', e);\n      return {\n        success: false,\n        message: e instanceof Error && e.message ? e.message : 'Unexpected error'\n      };\n    }\n    setIsPaying(false);\n  };\n  return createElement(\"div\", {\n    className: \"renderer-core-payment-modal-methods\"\n  }, createElement(Fragment, null, size(methodsKeys) > 1 && createElement(Fragment, null, createElement(\"p\", {\n    className: css`\n\t\t\t\t\t\t\t\tcolor: ${generalTheme.questionsColor};\n\t\t\t\t\t\t\t\tfont-size: 20px;\n\t\t\t\t\t\t\t`\n  }, (_data$payments$labels = data.payments.labels?.select_payment_method) !== null && _data$payments$labels !== void 0 ? _data$payments$labels : 'Select a payment method'), createElement(\"div\", {\n    className: \"renderer-components-radio-control__options-group\"\n  }, createElement(RadioControl, {\n    id: \"payment-methods\",\n    selected: selected,\n    options: options,\n    onChange: setSelected\n  })))), discountAmount !== 0 && createElement(CustomerRender, {\n    slug: selected,\n    data: data,\n    onComplete: () => {\n      completeForm();\n      setPaymentData(null);\n    }\n  }), discountAmount === 0 && createElement(\"div\", null, createElement(Button, {\n    className: classnames({\n      loading: isPaying\n    }, css`\n\t\t\t\t\t\t\t\t&.loading .renderer-core-arrow-icon {\n\t\t\t\t\t\t\t\t\tdisplay: none;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t`, 'payment-button'),\n    onClick: () => {\n      completeFullDiscountedOrders();\n    }\n  }, createElement(\"span\", {\n    id: \"button-text\"\n  }, isPaying ? createElement(Loader, {\n    color: generalTheme.buttonsFontColor,\n    height: 50,\n    width: 50\n  }) : createElement(Fragment, null, (_data$payments$labels2 = data?.payments?.labels?.pay) !== null && _data$payments$labels2 !== void 0 ? _data$payments$labels2 : __('Pay now', 'quillforms'))))));\n};\nexport default Methods;","map":{"version":3,"names":["getPaymentGatewayModules","Button","configApi","RadioControl","useState","useDispatch","__","useGeneralTheme","css","size","classnames","TailSpin","Loader","Methods","data","_urlParams$get","_data$payments$labels","_data$payments$labels2","setPaymentData","completeForm","generalTheme","gateways","methodsKeys","Object","keys","payments","methods","options","map","key","gateway","method","split","label","customer","text","value","urlParams","URLSearchParams","window","location","search","defaultMethod","get","includes","_urlParams$get2","selected","setSelected","CustomerRender","render","discountDetails","discount_details","discountAmount","amount","isPaying","setIsPaying","completeFullDiscountedOrders","submission_id","hashed_id","response","fetch","getAdminUrl","body","action","submissionId","hashedId","result","json","success","Error","message","e","console","log","createElement","className","Fragment","questionsColor","labels","select_payment_method","id","onChange","slug","onComplete","loading","onClick","color","buttonsFontColor","height","width","pay"],"sources":["/Users/amurepinho/Documents/GitHub/diagnostico/node_modules/@quillforms/renderer-core/build-module/components/payment-modal/methods/@quillforms/renderer-core/src/components/payment-modal/methods/index.tsx"],"sourcesContent":["/**\r\n * QuillForms Dependencies\r\n */\r\nimport { getPaymentGatewayModules } from '@quillforms/payment-gateways';\r\nimport Button from '../../button';\r\nimport configApi from '@quillforms/config';\r\n\r\n/**\r\n * WordPress Dependencies\r\n */\r\nimport RadioControl from './radio-control';\r\nimport { useState } from '@wordpress/element';\r\nimport { useDispatch } from '@wordpress/data';\r\nimport { __ } from '@wordpress/i18n';\r\nimport useGeneralTheme from '../../../hooks/use-general-theme';\r\n\r\n/**\r\n * External Dependencies\r\n */\r\nimport { css } from 'emotion';\r\nimport { size } from 'lodash';\r\nimport classnames from 'classnames';\r\nimport { TailSpin as Loader } from 'react-loader-spinner';\r\n\r\ninterface Props {\r\n\tdata: any;\r\n}\r\n\r\nconst Methods: React.FC<Props> = ({ data }) => {\r\n\tconst { setPaymentData, completeForm } = useDispatch(\r\n\t\t'quillForms/renderer-core'\r\n\t);\r\n\tconst generalTheme = useGeneralTheme();\r\n\r\n\tconst gateways = getPaymentGatewayModules();\r\n\tconst methodsKeys = Object.keys(data.payments.methods);\r\n\r\n\tconst options = methodsKeys.map((key) => {\r\n\t\tconst [gateway, method] = key.split(':');\r\n\t\treturn {\r\n\t\t\tlabel: gateways[gateway].methods[method].customer.label.text,\r\n\t\t\tvalue: key,\r\n\t\t};\r\n\t});\r\n\r\n\tconst urlParams = new URLSearchParams(window.location.search);\r\n\tlet defaultMethod = methodsKeys[0];\r\n\tif (\r\n\t\turlParams.get('step') === 'payment' &&\r\n\t\tmethodsKeys.includes(urlParams.get('method') ?? '')\r\n\t) {\r\n\t\tdefaultMethod = urlParams.get('method') ?? '';\r\n\t}\r\n\r\n\tconst [selected, setSelected] = useState(defaultMethod);\r\n\tconst [gateway, method] = selected.split(':');\r\n\r\n\tconst CustomerRender =\r\n\t\tgateways[gateway].methods[method].customer.render;\r\n\tconst discountDetails = data.payments?.discount_details;\r\n\tconst discountAmount = discountDetails?.amount;\r\n\tconst [isPaying, setIsPaying] = useState(false);\r\n\tconst completeFullDiscountedOrders = async () => {\r\n\t\tif (isPaying) return;\r\n\t\tsetIsPaying(true);\r\n\t\ttry {\r\n\t\t\tconst { submission_id, hashed_id } = data;\r\n\t\t\tlet response = await fetch(\r\n\t\t\t\tconfigApi.getAdminUrl() + 'admin-ajax.php',\r\n\t\t\t\t{\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tbody: new URLSearchParams({\r\n\t\t\t\t\t\taction: 'quillforms_complete_full_discounted_orders',\r\n\t\t\t\t\t\tsubmissionId: submission_id,\r\n\t\t\t\t\t\thashedId: hashed_id,\r\n\t\t\t\t\t}),\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tlet result = await response.json();\r\n\t\t\tif (result.success) {\r\n\t\t\t\tcompleteForm();\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(result.message);\r\n\t\t\t}\r\n\t\t} catch (e) {\r\n\t\t\tconsole.log('completePendingSubmission: error throwed', e);\r\n\t\t\treturn {\r\n\t\t\t\tsuccess: false,\r\n\t\t\t\tmessage:\r\n\t\t\t\t\te instanceof Error && e.message\r\n\t\t\t\t\t\t? e.message\r\n\t\t\t\t\t\t: 'Unexpected error',\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tsetIsPaying(false);\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"renderer-core-payment-modal-methods\">\r\n\t\t\t<>\r\n\t\t\t\t{size(methodsKeys) > 1 && (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<p\r\n\t\t\t\t\t\t\tclassName={css`\r\n\t\t\t\t\t\t\t\tcolor: ${generalTheme.questionsColor};\r\n\t\t\t\t\t\t\t\tfont-size: 20px;\r\n\t\t\t\t\t\t\t` }\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{data.payments.labels?.select_payment_method ??\r\n\t\t\t\t\t\t\t\t'Select a payment method'}\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t<div className=\"renderer-components-radio-control__options-group\">\r\n\t\t\t\t\t\t\t<RadioControl\r\n\t\t\t\t\t\t\t\tid=\"payment-methods\"\r\n\t\t\t\t\t\t\t\tselected={selected}\r\n\t\t\t\t\t\t\t\toptions={options}\r\n\t\t\t\t\t\t\t\tonChange={setSelected}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</>\r\n\t\t\t\t)}\r\n\t\t\t</>\r\n\t\t\t{discountAmount !== 0 && (\r\n\t\t\t\t<CustomerRender\r\n\t\t\t\t\tslug={selected}\r\n\t\t\t\t\tdata={data}\r\n\t\t\t\t\tonComplete={() => {\r\n\t\t\t\t\t\tcompleteForm();\r\n\t\t\t\t\t\tsetPaymentData(null);\r\n\t\t\t\t\t}}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\t\t\t{discountAmount === 0 && (\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<Button\r\n\t\t\t\t\t\tclassName={classnames(\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tloading: isPaying,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcss`\r\n\t\t\t\t\t\t\t\t&.loading .renderer-core-arrow-icon {\r\n\t\t\t\t\t\t\t\t\tdisplay: none;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t\t'payment-button'\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tcompleteFullDiscountedOrders();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<span id=\"button-text\">\r\n\t\t\t\t\t\t\t{isPaying ? (\r\n\t\t\t\t\t\t\t\t<Loader\r\n\t\t\t\t\t\t\t\t\tcolor={generalTheme.buttonsFontColor}\r\n\t\t\t\t\t\t\t\t\theight={50}\r\n\t\t\t\t\t\t\t\t\twidth={50}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t{data?.payments?.labels?.pay ??\r\n\t\t\t\t\t\t\t\t\t\t__('Pay now', 'quillforms')}\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Methods;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}